<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#"><head>

<title>第12章 メンテナンス、故障およびデバッグ - OpenStack 運用ガイド</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><meta name="mavenGroupId" content="org.openstack.docs"/><meta name="mavenArtifactId" content="openstack-ops-manual"/><meta name="mavenVersionId" content="1.0.0"/><link rel="home" href="index.html" title="OpenStack 運用ガイド"/><link rel="up" href="index.html" title="OpenStack 運用ガイド"/><link rel="prev" href="database_instances.html" title="データベースにあるインスタンス"/><link rel="next" href="network_troubleshooting.html" title="第13章 ネットワークのトラブルシューティング"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-10654";
            var language = "ja";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Your browser is not supported. Use of Mozilla Firefox is recommended.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
        </script><style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
            
        </style><link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"/><link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/><link rel="stylesheet" type="text/css" href="../common/css/custom.css"/><!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
	<![endif]--><link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/><link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/><script type="text/javascript" src="../common/jquery/jquery-1.4.3.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script><script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery.qtip-1.0.0-rc3/jquery.qtip-1.0.0-rc3.min.js"><!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script><script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script><script type="text/javascript" src="search/nwSearchFnt.js"><!----></script><script type="text/javascript" src="search/stemmers/ja_stemmer.js"><!--//make this scalable to other languages as well.--></script><script type="text/javascript" src="search/index-1.js"><!----></script><script type="text/javascript" src="search/index-2.js"><!----></script><script type="text/javascript" src="search/index-3.js"><!----></script><script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
	        </script><script type="text/javascript" src="../common/ga.js"><!----></script></head><body><div id="header"><a onclick="_gaq.push(['_trackEvent', 'Header', 'logo', 'click', 1]);" target="_blank" href="http://www.openstack.org"><img src="../common/images/openstack-logo.png" alt="OpenStack Documentation" width="157" height="47"/></a><h1>第12章 メンテナンス、故障およびデバッグ</h1><div id="navheader" align="right"><!----><table class="navLinks"><tr><td><a id="showHideButton" onclick="showHideToc(); _gaq.push(['_trackEvent', 'Header', 'show/hide', 'click', 1]);" class="pointLeft" title="Hide TOC tree">Sidebar
                            </a></td><td><a accesskey="p" class="navLinkPrevious" onclick="_gaq.push(['_trackEvent', 'Header', 'prevLink', 'click', 1]);" tabindex="5" href="database_instances.html">戻る</a> 
				  |
                                    <a accesskey="n" class="navLinkNext" onclick="_gaq.push(['_trackEvent', 'Header', 'nextLink', 'click', 1]);" tabindex="5" href="network_troubleshooting.html">次へ</a></td></tr></table></div></div><div id="toolbar" class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"><div id="toolbar-left"><p class="breadcrumbs"><a href="http://docs.openstack.org/">OpenStack Manuals</a><a href="index.html">OpenStack 運用ガイド</a></p><a onclick="_gaq.push(['_trackEvent', 'Header', 'pdfDownload', 'click', 1]);" alt="Download a pdf of this document" class="pdficon" href="../openstack-ops-manual-local.pdf"><img src="../common/images/pdf.png"/></a></div></div><div id="content"><div class="statustext"> </div><div xml:lang="ja" class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="maintenance"> </a>第12章 メンテナンス、故障およびデバッグ</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#cloud_controller_storage">クラウドコントローラーとストレージプロキシの故障とメンテナンス</a></span></dt><dt><span class="section"><a href="maintenance.html#compute_node_failures">コンピュートノードの故障とメンテナンス</a></span></dt><dt><span class="section"><a href="maintenance.html#storage_node_failures">ストレージノードの故障とメンテナンス</a></span></dt><dt><span class="section"><a href="maintenance.html#complete_failure">完全な故障の対処</a></span></dt><dt><span class="section"><a href="maintenance.html#config_mgmt">構成管理</a></span></dt><dt><span class="section"><a href="maintenance.html#hardware">ハードウェアの取り扱い</a></span></dt><dt><span class="section"><a href="maintenance.html#databases">データベース</a></span></dt><dt><span class="section"><a href="maintenance.html#hdmy">HDWMY</a></span></dt><dt><span class="section"><a href="maintenance.html#broken_component">故障しているコンポーネントの特定</a></span></dt></dl></div><p>停止時間（計画的なものと予定外のものの両方）はクラウドを運用するときに確実に発生します。本章は、プロアクティブまたはリアクティブに、これらの出来事に対処するために有用な情報を提供することを目的としています。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="cloud_controller_storage"> </a>クラウドコントローラーとストレージプロキシの故障とメンテナンス</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#planned_maintenance">計画メンテナンス</a></span></dt><dt><span class="section"><a href="maintenance.html#reboot_cloud_controller">クラウドコントローラーとストレージプロキシの再起動</a></span></dt><dt><span class="section"><a href="maintenance.html#after_a_cc_reboot">クラウドコントローラーまたはストレージプロキシの再起動後</a></span></dt><dt><span class="section"><a href="maintenance.html#cc_failure">全体的なクラウドコントローラーの故障</a></span></dt></dl></div><p>想定内の場合も想定外の場合も停止時間が発生した場合の挙動が、クラウドコントローラーとストレージプロキシは互いに似ています。クラウドコントローラーとストレージプロキシはそれぞれクラウドで一つ実行されるので、動作していない場合、非常に目立ちます。</p><p>クラウドコントローラーの場合、良いニュースとしては、クラウドが FlatDHCP マルチホスト HA ネットワークモードを使用していれば、既存のインスタンスとボリュームはクラウドコントローラーがオフラインの間も動作を継続するという点があります。しかしながら、ストレージプロキシの場合には、サーバーが元に戻され動作状態になるまで、ストレージとの通信ができません。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="planned_maintenance"> </a>計画メンテナンス</h3></div></div></div><p>クラウドコントローラーやストレージプロキシのメンテナンスを計画する一つの方法は、単に午前 1 時や 2 時のような利用の少ない時間帯に実行することです。この戦略はあまり多くのユーザーに影響を与えません。クラウドコントローラーやストレージプロキシが、いかなる時間帯においても、サービスが利用できないことによる影響が大きければ、高可用性オプションについて検討する必要があります。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="reboot_cloud_controller"> </a>クラウドコントローラーとストレージプロキシの再起動</h3></div></div></div><p>多くの場合、「reboot」コマンドを発行するだけです。オペレーティングシステムが正常にサービスをシャットダウンし、自動的に再起動します。万全を期したい場合、再起動する前にバックアップジョブを実行してください。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="after_a_cc_reboot"> </a>クラウドコントローラーまたはストレージプロキシの再起動後</h3></div></div></div><p>クラウドコントローラーを再起動した後、すべての必要なサービスが正常に起動したことを確認します。</p><pre class="programlisting"># ps aux | grep nova-
# grep AMQP /var/log/nova/nova-*.log
# ps aux | grep glance-
# ps aux | grep keystone
# ps aux | grep cinder</pre><p>また、すべてのサービスが正しく機能していることを確認します。</p><pre class="programlisting"># source openrc
# glance index
# nova list
# keystone tenant-list</pre><p>ストレージプロキシの場合、Object Storage サービスが再開していることを確認します。</p><pre class="programlisting"># ps aux | grep swift</pre><p>また、正しく機能していることを確認します。</p><pre class="programlisting"># swift stat</pre></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="cc_failure"> </a>全体的なクラウドコントローラーの故障</h3></div></div></div><p>残念ながら、これはひどい状況です。クラウドコントローラーはクラウドの不可欠な部分です。コントローラーが一つだけならば、多くのサービスが失われます。</p><p>この状況を避けるために、高可用なクラウドコントローラークラスターを作成します。このことは、このドキュメントの範囲外ですが、ドラフト版の <a class="link" href="http://docs.openstack.org/trunk/openstack-ha/content/ch-intro.html" title="OpenStack High Availability Guide" target="_top">OpenStack High Availability Guide</a> が http://docs.openstack.org/trunk/openstack-ha/content/ch-intro.html にあります。</p><p>次に最も優れている方法は、クラウドコントローラーを自動的に構築するために Puppet のような構成管理ツールを使用することです。利用可能な予備サーバーがあれば、15 分もかかりません。コントローラーを再構築後、取得したすべてのバックアップを復元します (<span class="bold"><strong>バックアップとリカバリー</strong></span> の章を参照してください)。</p><p>実際には、コンピュートノードの nova-compute サービスがときどき、コントローラー上で動作している rabbitmq に正しく再接続されない場合があります。時間のかかるリブートから戻ってきた場合や、コンピュートノードのnova サービスを再起動する必要がある場合です。</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="compute_node_failures"> </a>コンピュートノードの故障とメンテナンス</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#planned_maintenance_compute_node">計画メンテナンス</a></span></dt><dt><span class="section"><a href="maintenance.html#after_compute_node_reboot">コンピュートノードの再起動後</a></span></dt><dt><span class="section"><a href="maintenance.html#maintenance_instances">インスタンス</a></span></dt><dt><span class="section"><a href="maintenance.html#inspect_and_recover_failed_instances">故障したインスタンスからの検査とデータ復旧</a></span></dt><dt><span class="section"><a href="maintenance.html#volumes">ボリューム</a></span></dt><dt><span class="section"><a href="maintenance.html#totle_compute_node_failure">コンピュートノード全体の故障</a></span></dt><dt><span class="section"><a href="maintenance.html#var_lib_nova_instances">/var/lib/nova/instances</a></span></dt></dl></div><p>コンピュートノードは、予期せずクラッシュしたり、メンテナンスのために再起動が必要になったりすることがときどきあります。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="planned_maintenance_compute_node"> </a>計画メンテナンス</h3></div></div></div><p>(ソフトウェアやハードウェアのアップグレードのように) 計画されたメンテナンスのために、コンピュートノードを再起動する必要があれば、まずホストしている全インスタンスがノード外に移動していることを確認します。クラウドが共有ストレージを利用していれば、<code class="code">nova live-migration</code>  コマンドを使用します。初めに、移動させる必要があるインスタンスの一覧を取得します。</p><pre class="programlisting"># nova list --host c01.example.com --all-tenants</pre><p>次に、それらを一つずつマイグレーションします。</p><pre class="programlisting"># nova live-migration &lt;uuid&gt; c02.example.com</pre><p>共有ストレージを使用していない場合、<code class="code">--block-migrate</code> オプションを使用できます。</p><pre class="programlisting"># nova live-migration --block-migrate &lt;uuid&gt; c02.example.com</pre><p>すべてのインスタンスをマイグレーションした後、<code class="code">nova-compute</code> サービスが停止していることを確認します。</p><pre class="programlisting"># stop nova-compute</pre><p>Puppet などの構成管理システムを使って、<code class="code">nova-compute</code> サービスが確実に実行されているようにしている場合、init ファイルを一時的に移動します。</p><pre class="programlisting"># mkdir /root/tmp
# mv /etc/init/nova-compute.conf /root/tmp
# mv /etc/init.d/nova-compute /root/tmp</pre><p>続けて、コンピュートノードを停止し、メンテナンスを実行し、ノードを元に戻します。先のコマンドを逆に実行することにより、<code class="code">nova-compute</code> サービスを再び有効化できます。</p><pre class="programlisting"># mv /root/tmp/nova-compute.conf /etc/init
# mv /root/tmp/nova-compute /etc/init.d/</pre><p>そして <code class="code">nova-compute</code> サービスを起動します。</p><pre class="programlisting"># start nova-compute</pre><p>インスタンスを元のコンピュートノードにマイグレーションすることもできます。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="after_compute_node_reboot"> </a>コンピュートノードの再起動後</h3></div></div></div><p>コンピュートノードを再起動した場合、まず正常に起動したことを確認します。これには <code class="code">nova-compute</code> サービスが実行していることを確認することが含まれます。</p><pre class="programlisting"># ps aux | grep nova-compute
# status nova-compute</pre><p>AMQP サーバーに正常に接続できることも確認します。</p><pre class="programlisting"># grep AMQP /var/log/nova/nova-compute
2013-02-26 09:51:31 12427 INFO nova.openstack.common.rpc.common [-] Connected to AMQP server on 199.116.232.36:5672</pre><p>コンピュートノードが正常に実行された後、そのコンピュートノードでホストされているインスタンスはどれも動作していないので、そのコンピュートノードにおいてホストされているインスタンスを処理する必要があります。ユーザーや顧客に対する SLA によっては、各インスタンスを開始し、正常に起動していることを確認する必要がある場合もあるでしょう。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="maintenance_instances"> </a>インスタンス</h3></div></div></div><p>以下のコマンドを実行することにより、コンピュートノードにおいてホストされているインスタンスの一覧を作成できます。</p><pre class="programlisting"># nova list --host c01.example.com --all-tenants</pre><p>一覧を取得した後、各インスタンスを起動するために nova コマンドを使用できます。</p><pre class="programlisting"># nova reboot &lt;uuid&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../common/images/admon/note.png"/></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>予期せずシャットダウンしたときは、ブートに問題があるかもしれません。たとえば、インスタンスがルートパーティションにおいて <code class="code">fsck</code> を実行する必要があるかもしれません。もしこうなっても、これを修復するためにダッシュボード VNC コンソールを使用できます。</p></td></tr></table></div><p>インスタンスがブートしなければ、つまりブートしようとしても <code class="code">virsh list</code> がインスタンスを表示しなければ、コンピュートノードにおいて以下のとおり実行します。</p><pre class="programlisting"># tail -f /var/log/nova/nova-compute.log</pre><p>再び <code class="code">nova reboot</code> コマンドを実行してみてください。インスタンスがなぜブートできないかについて、エラーメッセージを確認すべきです。</p><p>多くの場合、libvirt の XML ファイル (<code class="code">/etc/libvirt/qemu/instance-xxxxxxxx.xml</code>) の何かがすでに存在しないことで、エラーが発生する。次のとおり実行することにより、インスタンスを再起動するのと同時に、強制的に XML ファイルを再作成できます。</p><pre class="programlisting"># nova reboot --hard &lt;uuid&gt;</pre></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="inspect_and_recover_failed_instances"> </a>故障したインスタンスからの検査とデータ復旧</h3></div></div></div><p>いくつかのシナリオでは、インスタンスが実行中であるにも関わらず、SSH 経由でアクセスできず、あらゆるコマンドに反応がありません。VNC コンソールがブート失敗やカーネルパニックのエラーメッセージを表示している可能性があります。これは仮想マシン自身においてファイルシステム破損の意味する可能性があります。ファイルを復旧したりインスタンスの中身を調査したりする必要があれば、qemu-nbd を使ってディスクをマウントできます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../common/images/admon/note.png"/></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>ユーザーのコンテンツやデータにアクセスしたり表示したりする場合は、まず承認をもらってください!</p></td></tr></table></div><p>インスタンスのディスク (/var/lib/nova/instances/instance-xxxxxx/disk) にアクセスするには、以下の手順に従う必要があります。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>virsh コマンドを使用してインスタンスをサスペンドします。</p></li><li class="listitem"><p>qemu-nbd デバイスをディスクに接続します。</p></li><li class="listitem"><p>qemu-nbd デバイスをマウントします。</p></li><li class="listitem"><p>デバイスを調査後、アンマウントします。</p></li><li class="listitem"><p>qemu-nbd デバイスを切断します。</p></li><li class="listitem"><p>インスタンスを再開します。</p></li></ol></div><p>手順 4-6 を省略すると、OpenStack Compute がインスタンスを管理できなくなります。OpenStack Compute により発行されるすべてのコマンドに対する応答が失敗し、シャットダウンしているように見えます。</p><p>ディスクファイルをマウントすると、それにアクセスでき、ファイルとディレクトリ構造を持つ通常のディレクトリのように取り扱えます。しかしながら、どのファイルの編集も操作もしないことをお薦めします。なぜなら、それにより ACL が変更されたり、起動できるインスタンスが起動できなくなってします場合があるからです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>virsh コマンドを使用してインスタンスを一時停止します - 内部 ID を記録します。</p><pre class="programlisting">root@compute-node:~# virsh list
Id Name                 State
----------------------------------
1 instance-00000981    running
2 instance-000009f5    running 
30 instance-0000274a    running
                  
root@compute-node:~# virsh suspend 30
Domain 30 suspended</pre></li><li class="listitem"><p>qemu-nbd デバイスをディスクに接続します。</p><pre class="programlisting">root@compute-node:/var/lib/nova/instances/instance-0000274a# ls -lh
total 33M
-rw-rw---- 1 libvirt-qemu kvm  6.3K Oct 15 11:31 console.log
-rw-r--r-- 1 libvirt-qemu kvm   33M Oct 15 22:06 disk
-rw-r--r-- 1 libvirt-qemu kvm  384K Oct 15 22:06 disk.local
-rw-rw-r-- 1 nova         nova 1.7K Oct 15 11:30 libvirt.xml
root@compute-node:/var/lib/nova/instances/instance-0000274a# qemu-nbd -c /dev/nbd0 `pwd`/disk             </pre></li><li class="listitem"><p>qemu-nbd デバイスをマウントします。</p><p>qemu-nbd デバイスはインスタンスのディスクの個々のパーティションを別々のデバイスとしてエクスポートしようとします。たとえば、ディスクが vda で、ルートパーティションが vda1 の場合、qemu-nbd はそれぞれ /dev/nbd0 と /dev/nbd0p1 としてデバイスをエクスポートします。</p><pre class="programlisting">#mount the root partition of the device
root@compute-node:/var/lib/nova/instances/instance-0000274a# mount /dev/nbd0p1 /mnt/
# List the directories of mnt, and the vm's folder is display
# You can inspect the folders and access the /var/log/ files</pre><p>セカンダリディスクや一時ディスクを調査する際に、プライマリディスクとセカンダリディスクを同時にマウントしたければ、別のマウントポイントを使用してください。</p><pre class="programlisting"># umount /mnt
# qemu-nbd -c /dev/nbd1 `pwd`/disk.local
# mount /dev/nbd1 /mnt/</pre><pre class="programlisting">root@compute-node:/var/lib/nova/instances/instance-0000274a# ls -lh /mnt/
total 76K
lrwxrwxrwx.  1 root root    7 Oct 15 00:44 bin -&gt; usr/bin
dr-xr-xr-x.  4 root root 4.0K Oct 15 01:07 boot
drwxr-xr-x.  2 root root 4.0K Oct 15 00:42 dev
drwxr-xr-x. 70 root root 4.0K Oct 15 11:31 etc
drwxr-xr-x.  3 root root 4.0K Oct 15 01:07 home
lrwxrwxrwx.  1 root root    7 Oct 15 00:44 lib -&gt; usr/lib
lrwxrwxrwx.  1 root root    9 Oct 15 00:44 lib64 -&gt; usr/lib64
drwx------.  2 root root  16K Oct 15 00:42 lost+found
drwxr-xr-x.  2 root root 4.0K Feb  3  2012 media
drwxr-xr-x.  2 root root 4.0K Feb  3  2012 mnt
drwxr-xr-x.  2 root root 4.0K Feb  3  2012 opt
drwxr-xr-x.  2 root root 4.0K Oct 15 00:42 proc
dr-xr-x---.  3 root root 4.0K Oct 15 21:56 root
drwxr-xr-x. 14 root root 4.0K Oct 15 01:07 run
lrwxrwxrwx.  1 root root    8 Oct 15 00:44 sbin -&gt; usr/sbin
drwxr-xr-x.  2 root root 4.0K Feb  3  2012 srv
drwxr-xr-x.  2 root root 4.0K Oct 15 00:42 sys
drwxrwxrwt.  9 root root 4.0K Oct 15 16:29 tmp
drwxr-xr-x. 13 root root 4.0K Oct 15 00:44 usr
drwxr-xr-x. 17 root root 4.0K Oct 15 00:44 var</pre></li><li class="listitem"><p>調査を完了すると、マウントポイントをアンマウントし、qemu-nbd デバイスを解放します。</p><pre class="programlisting">root@compute-node:/var/lib/nova/instances/instance-0000274a# umount /mnt
root@compute-node:/var/lib/nova/instances/instance-0000274a# qemu-nbd -d /dev/nbd0
/dev/nbd0 disconnected</pre></li><li class="listitem"><p>virsh を使用してインスタンスを再開します。</p><pre class="programlisting">root@compute-node:/var/lib/nova/instances/instance-0000274a# virsh list
Id Name                 State
----------------------------------
1 instance-00000981    running
2 instance-000009f5    running
30 instance-0000274a    paused
                  
root@compute-node:/var/lib/nova/instances/instance-0000274a# virsh resume 30
Domain 30 resumed</pre></li></ol></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="volumes"> </a>ボリューム</h3></div></div></div><p>影響のあったインスタンスがボリュームを接続していれば、まずインスタンスとボリュームの UUID 一覧を生成します。</p><pre class="programlisting">mysql&gt; select nova.instances.uuid as instance_uuid, cinder.volumes.id as volume_uuid, cinder.volumes.status, 
cinder.volumes.attach_status, cinder.volumes.mountpoint, cinder.volumes.display_name from cinder.volumes
inner join nova.instances on cinder.volumes.instance_uuid=nova.instances.uuid 
 where nova.instances.host = 'c01.example.com';</pre><p>以下のような結果を確認できます。</p><pre class="programlisting">+---------------+-------------+--------+---------------+------------+--------------+ 
| instance_uuid | volume_uuid | status | attach_status | mountpoint | display_name | 
+---------------+-------------+--------+---------------+------------+--------------+ 
| 9b969a05      | 1f0fbf36    | in-use | attached      | /dev/vdc   | test         | 
+---------------+-------------+--------+---------------+------------+--------------+ 
1 row in set (0.00 sec)</pre><p>次に、ボリュームを手動で切断し、再接続します。</p><pre class="programlisting"># nova volume-detach &lt;instance_uuid&gt; &lt;volume_uuid&gt;
# nova volume-attach &lt;instance_uuid&gt; &lt;volume_uuid&gt; /dev/vdX</pre><p>ここで、X には適切なマウントポイントを指定します。上記を実行する前に、インスタンスが正常に起動し、ログイン画面になっていることを確認します。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="totle_compute_node_failure"> </a>コンピュートノード全体の故障</h3></div></div></div><p>コンピュートノードが故障し、2〜3時間もしくはそれ以上たっても復旧できないと見込まれる場合、<code class="code">/var/lib/nova/instances</code> に共有ストレージを使用していれば、故障したノードで動作していたインスタンスをすべて再スタートすることができます。</p><p>これを実行するために、nova データベースにおいて以下のクエリーを実行することにより、故障したノードにおいてホストされているインスタンスの UUID の一覧を生成します。</p><pre class="programlisting">mysql&gt; select uuid from instances where host = 'c01.example.com' and deleted = 0;</pre><p>次に、c01.example.com においてホストされていたすべてのインスタンスが、今度は c02.example.com でホストされることを Nova に教えます。</p><pre class="programlisting">mysql&gt; update instances set host = 'c02.example.com' where host = 'c01.example.com' and deleted = 0;</pre><p>その後、nova コマンドを使って、c01.example.com にあったすべてのインスタンスを再起動します。起動する際にインスタンスの XML ファイルを再生成します。</p><pre class="programlisting"># nova reboot --hard &lt;uuid&gt;</pre><p>最後に、<span class="bold"><strong>コンピュートノードの再起動後</strong></span> に説明されているのと同じ方法を用いて、ボリュームを再接続します。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="var_lib_nova_instances"> </a>/var/lib/nova/instances</h3></div></div></div><p>コンピュートノードの故障の話題に関連して、このディレクトリについては説明しておく価値があるでしょう。このディレクトリには、コンピュートノードにホストされているインスタンス用の libvirt KVM のファイル形式のディスクイメージが置かれます。共有ストレージ環境でクラウドを実行していなければ、このディレクトリはコンピュートノード全体で一つしかありません。</p><p><code class="code">/var/lib/nova/instances</code> には 2 種類のディレクトリがあります。</p><p>一つ目は <code class="code">_base</code> ディレクトリです。ここには、そのコンピュートノードで起動されたそれぞれのイメージに関して、glance から取得したすべてのベースイメージのキャッシュが置かれます。<code class="code">_20</code> (または他の番号) で終わるファイルは一時ディスクのベースイメージです。</p><p>もう一つのディレクトリは <code class="code">instance-xxxxxxxx</code> という名前です。これらのディレクトリはコンピュートノードにおいて実行中のインスタンスと対応します。中にあるファイルは <code class="code">_base</code> ディレクトリにあるファイルのどれかと関連があります。これらは基本的に、元々の <code class="code">_base</code> ディレクトリからの変更点のみ含む、差分ベースのファイルです。</p><p><code class="code">/var/lib/nova/instances</code> にあるすべてのファイルとディレクトリは一意に名前が付けられています。_base にあるファイルは元となった glance イメージに対応する一意に名前が付けられています。また、<code class="code">instance-xxxxxxxx</code> という名前が付けられたディレクトリは特定のインスタンスに対して一意にタイトルが付けられています。たとえば、あるコンピュートノードにある <code class="code">/var/lib/nova/instances</code> のすべてのデータを他のノードにコピーしたとしても、ファイルを上書きすることはありませんし、また同じ一意な名前を持つイメージにダメージを与えることもありません。同じ一意な名前を持つものは本質的に同じファイルだからです。</p><p>この方法はドキュメントに書かれておらず、サポートされていない方法ですが、コンピュートノードが完全にオフラインになってしまったが、インスタンスがローカルに保存されているときに、この方法を使用できます。</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="storage_node_failures"> </a>ストレージノードの故障とメンテナンス</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#reboot_storage_node">ストレージノードの再起動</a></span></dt><dt><span class="section"><a href="maintenance.html#shut_down_storage_node">ストレージノードのシャットダウン</a></span></dt><dt><span class="section"><a href="maintenance.html#replace_swift_disk">Swift ディスクの交換</a></span></dt></dl></div><p>オブジェクトストレージの高い冗長性のため、オブジェクトストレージのノードに関する問題を処理することは、コンピュートノードに関する問題を処理するよりも簡単です。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="reboot_storage_node"> </a>ストレージノードの再起動</h3></div></div></div><p>ストレージノードの再起動が必要ならば、単に再起動します。そのノードにホストされているデータに対する要求は、サーバーが再起動している間、他のコピーに転送されます。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="shut_down_storage_node"> </a>ストレージノードのシャットダウン</h3></div></div></div><p>ストレージノードを少し長い間 (1 日以上) シャットダウンする必要があれば、ノードをストレージリングから削除することを検討します。例:</p><pre class="programlisting"># swift-ring-builder account.builder remove &lt;ip address of storage node&gt;
# swift-ring-builder container.builder remove &lt;ip address of storage node&gt;
# swift-ring-builder object.builder remove &lt;ip address of storage node&gt;
# swift-ring-builder account.builder rebalance
# swift-ring-builder container.builder rebalance
# swift-ring-builder object.builder rebalance   </pre><p>次に、ring ファイルを他のノードに再配布します。</p><pre class="programlisting"># for i in s01.example.com s02.example.com s03.example.com
&gt; do
&gt; scp *.ring.gz $i:/etc/swift
&gt; done    </pre><p>これらの操作はストレージノードをストレージクラスターから効率的に外せます。</p><p>ノードがクラスターに参加できるようになったら、ただリングに再度追加するだけです。<code class="code">swift-ring-builder</code> を使用して Swift クラスターにノードを追加するための構文は、元々クラスターを作成したときに使用した元々のオプションに強く依存します。作成時に使用したコマンドをもう一度見てください。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="replace_swift_disk"> </a>Swift ディスクの交換</h3></div></div></div><p>Object Storage ノードのハードディスクが故障した場合、その交換は比較的簡単です。Object Storage 環境が正しく設定され、故障したディスクに保存されているデータが Object Storage 環境内の他のディスクにも複製されていることを前提にしています。</p><p>この例では、<code class="code">/dev/sdb</code> が故障したと仮定します。</p><p>まず、ディスクをアンマウントします。</p><pre class="programlisting"># umount /dev/sdb</pre><p>次に、ディスクを物理的にサーバーから取り外し、正常なディスクと入れ替えます。</p><p>オペレーティングシステムが新しいディスクを認識していることを確認します。</p><pre class="programlisting"># dmesg | tail</pre><p>/dev/sdb に関するメッセージを確認したほうがいいです。</p><p>Swift ディスクではパーティションを使用しないことが推奨されるので、単にディスク全体をフォーマットします。</p><pre class="programlisting"># mkfs.xfs -i size=1024 /dev/sdb</pre><p>最後に、ディスクをマウントします。</p><pre class="programlisting"># mount -a</pre><p>Swift は新しいディスクを認識します。また、データが存在しないことを認識します。そうすると、他の既存の複製からディスクにデータを複製しはじめます。</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="complete_failure"> </a>完全な故障の対処</h2></div></div></div><p>データセンターの電力消失のような、完全なシステム故障から復旧する一般的な方法は、各サービスに優先度を付け、順番に復旧することです。</p><table rules="all" id="d6e2443"><caption>表12.1 サービス復旧優先度一覧の例</caption><tbody><tr>
                    <td><p>1</p></td>
                    <td><p>内部ネットワーク接続性</p></td>
                </tr><tr>
                    <td><p>2</p></td>
                    <td><p>バックエンドのストレージサービス</p></td>
                </tr><tr>
                    <td><p>3</p></td>
                    <td><p>ユーザーの仮想マシンに対するパブリックネットワーク接続性</p></td>
                </tr><tr>
                    <td><p>4</p></td>
                    <td><p>nova-compute, nova-network, cinder ホスト</p></td>
                </tr><tr>
                    <td><p>5</p></td>
                    <td><p>ユーザーの仮想マシン</p></td>
                </tr><tr>
                    <td><p>10</p></td>
                    <td><p>メッセージキューとデータベースのサービス</p></td>
                </tr><tr>
                    <td><p>15</p></td>
                    <td><p>Keystone サービス</p></td>
                </tr><tr>
                    <td><p>20</p></td>
                    <td><p>cinder-scheduler</p></td>
                </tr><tr>
                    <td><p>21</p></td>
                    <td><p>イメージカタログとイメージ配信のサービス</p></td>
                </tr><tr>
                    <td><p>22</p></td>
                    <td><p>nova-scheduler サービス</p></td>
                </tr><tr>
                    <td><p>98</p></td>
                    <td><p>cinder-api</p></td>
                </tr><tr>
                    <td><p>99</p></td>
                    <td><p>nova-api サービス</p></td>
                </tr><tr>
                    <td><p>100</p></td>
                    <td><p>ダッシュボードサービス</p></td>
                </tr></tbody></table><p>この例にある優先度一覧を使用すると、きちんと安定した状態になる前であっても、できる限り早くユーザーに影響するサービスを復旧させることができます。もちろん、1 行の項目として一覧化されていますが、各ステップは多大な作業が必要です。たとえば、データベースを開始した後、その完全性を確認すべきです。また、Nova サービスを開始した後、ハイパーバイザーがデータベースに一致しているかを確認し、不一致があれば修正すべきです。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="config_mgmt"> </a>構成管理</h2></div></div></div><p>OpenStack クラウドをメンテナンスするには、複数の物理サーバーを管理することが必要です。そして、この数は日々増えていきます。ノードを手動で管理することはエラーを起こしやすいので、構成管理ツールを使用することを強く推奨します。これらのツールはすべてのノードが適切に設定されていることを保証するプロセスを自動化します。また、これらを使うことで、(パッケージや設定オプションといった) 構成情報のバージョン管理されたリポジトリでの管理が行いやすくなります。</p><p>いくつかの構成管理ツールがあります。このガイドでは特定のものを推奨しません。OpenStack コミュニティで人気があるものは <a class="link" href="https://puppetlabs.com/" target="_top">Puppet</a> (https://puppetlabs.com/) と <a class="link" href="http://www.opscode.com/chef/" target="_top">Chef</a> (http://opscode.com/chef) の 2 つで、OpenStack 用の設定集がそれぞれ <a class="link" href="http://github.com/puppetlabs/puppetlabs-openstack" title="Optimization Overview" target="_top">OpenStack Puppet modules</a> (http://github.com/puppetlabs/puppetlabs-openstack) と <a class="link" href="https://github.com/opscode/openstack-chef-repo" target="_top">OpenStack Chef recipes</a> (https://github.com/opscode/openstack-chef-repo) にあります。比較的新しい他のツールとしては、<a class="link" href="https://juju.ubuntu.com/" target="_top">Juju</a> (https://juju.ubuntu.com/)、<a class="link" href="http://ansible.cc" target="_top">Ansible</a> (http://ansible.cc) や <a class="link" href="http://saltstack.com/" target="_top">Salt</a> (http://saltstack.com) があります。もう少し成熟したツールとしては <a class="link" href="http://cfengine.com/" target="_top">CFEngine</a> (http://cfengine.com) や <a class="link" href="http://bcfg2.org/" target="_top">Bcfg2</a> (http://bcfg2.org) があります。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="hardware"> </a>ハードウェアの取り扱い</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#add_new_node">コンピュートノードの追加</a></span></dt><dt><span class="section"><a href="maintenance.html#add_new_object_node">オブジェクトストレージノードの追加</a></span></dt><dt><span class="section"><a href="maintenance.html#replace_components">コンポーネントの交換</a></span></dt></dl></div><p>初期導入時と同じように、本番環境に追加する前に、すべてのハードウェアについて適切な通電テストを行うべきでしょう。ハードウェアを限界まで使用するソフトウェアを実行します。RAM、CPU、ディスク、ネットワークを限界まで使用します。多くのオプションが利用可能であり、通常はベンチマークソフトウェアとの役割も果たします。そのため、システムのパフォーマンスに関する良いアイディアを得ることもできます。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="add_new_node"> </a>コンピュートノードの追加</h3></div></div></div><p>コンピューティングリソースのキャパシティ限界に達した、または達しそうとわかれば、さらなるコンピュートノードの追加を計画すべきです。さらなるノードを追加することは簡単です。ノードを追加する手順は、最初にコンピュートノードをクラウドに導入したときと同じです。自動配備システムを使ってベアメタルサーバーにオペレーティングシステムのインストールと起動を行い、次に構成管理システムによりOpenStack Compute サービスのインストールと設定を行います。他のコンピュートノードと同じ方法で Compute サービスのインストールと設定が終わると、自動的にクラウドに接続されます。クラウドコントローラーが新しいノードを検知し、そこにインスタンスを起動するようスケジュールし始めます。</p><p>OpenStack ブロックストレージノードがコンピュートノードから分離いる場合、同じキュー管理とポーリングのシステムが両方のサービスで使用されるので、同じ手順が適用できます。</p><p>新しいコンピュートノードとブロックストレージノードには、同じハードウェアを使用することを推奨します。最低限、ライブマイグレーションが失敗しないように、コンピュートノードでは CPU は同様のものにしてください。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="add_new_object_node"> </a>オブジェクトストレージノードの追加</h3></div></div></div><p>新しいオブジェクトストレージノードの追加は、コンピュートノードやブロックストレージノードの追加とは異なります。サーバーの設定は、これまで通り自動配備システムと構成管理システムを使って行えます。完了した後、オブジェクトストレージノードのローカルディスクをオブジェクトストレージリングに追加する必要があります。これを実行するコマンドは、最初にディスクをリングに追加するのに使用したコマンドと全く同じです。オブジェクトストレージプロキシサーバーにおいて、このコマンドを、新しいオブジェクトストレージノードにあるすべてのディスクに対して、再実行するだけです。これが終わったら、リングの再バランスを行い、更新されたリングファイルを他のストレージノードにコピーします。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../common/images/admon/note.png"/></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>新しいオブジェクトストレージノードのディスク数が元々のノードのディスク数と異なる場合には、新しいノードを追加するコマンドが元々のコマンドと異なります。これらのパラメーターは環境により異なります。</p></td></tr></table></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="replace_components"> </a>コンポーネントの交換</h3></div></div></div><p>クラウドインフラなどの大規模環境では、ハードウェアの故障はよくあることです。作業内容を考慮し、可用性と時間の節約のバランスを取ります。たとえば、オブジェクトストレージクラスターは、十分な容量がある場合には、ある程度の期間は死んだディスクがあっても問題なく動作します。また、(クラウド内の) コンピュートノードに空きがある場合には、問題に対処する時間が取れるまで、ライブマイグレーションで RAM が故障したホストから他のホストへインスタンスを移動させることも考慮するとよいでしょう。</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="databases"> </a>データベース</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#database_connect">データベース接続性</a></span></dt><dt><span class="section"><a href="maintenance.html#perf_and_opt">パフォーマンスと最適化</a></span></dt></dl></div><p>ほとんどすべての OpenStack コンポーネントは、永続的な情報を保存するために内部でデータベースを使用しています。このデータベースは通常 MySQL です。通常の MySQL の管理方法がこれらのデータベースに適用できます。OpenStack は特別な方法でデータベースを設定しているわけではありません。基本的な管理として、パフォーマンス調整、高可用性、バックアップ、リカバリーおよび修理などがあります。さらなる情報は標準の MySQL 管理ガイドを参照してください。</p><p>より迅速に情報を取得したり、データ不整合のエラーを修正したりするために、データベースでいくつかの小技を実行できます。たとえば、インスタンスが終了していたが、データベースの状態が更新されていなかった、という状況です。こうした小技がこのドキュメント全体を通して議論されています。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="database_connect"> </a>データベース接続性</h3></div></div></div><p>コンポーネントの設定ファイルを確認して、それぞれの OpenStack コンポーネントが対応するデータベースにどのようにアクセスするかを把握ください。<code class="code">sql_connection</code> またはただの <code class="code">connection</code> を探します。</p><pre class="programlisting"># grep -hE "connection ?=" /etc/nova/nova.conf /etc/glance/glance-*.conf 
/etc/cinder/cinder.conf /etc/keystone/keystone.conf
	sql_connection = mysql://nova:nova@cloud.alberta.sandbox.cybera.ca/nova
	sql_connection = mysql://glance:password@cloud.example.com/glance 
	sql_connection = mysql://glance:password@cloud.example.com/glance 
    sql_connection=mysql://cinder:password@cloud.example.com/cinder 
	connection = mysql://keystone_admin:password@cloud.example.com/keystone</pre><p>connection 文字列は以下の形式をとります。</p><pre class="programlisting">mysql:// &lt;username&gt; : &lt;password&gt; @ &lt;hostname&gt; / &lt;database name&gt;</pre></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="perf_and_opt"> </a>パフォーマンスと最適化</h3></div></div></div><p>クラウドが大きくなるにつれて、MySQL がさらに使用されてきます。MySQL がボトルネックになってきたことが疑われる場合、MySQL 最適化の調査から始めるとよいでしょう。MySQL のマニュアルでは、<a class="link" href="http://dev.mysql.com/doc/refman/5.5/en/optimize-overview.html" target="_top">Optimization Overview</a> (http://dev.mysql.com/doc/refman/5.5/en/optimize-overview.html) というセクションがあり、一つのセクション全部をあててこの話題を扱っています。</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="hdmy"> </a>HDWMY</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#hourly">毎時</a></span></dt><dt><span class="section"><a href="maintenance.html#daily">日次</a></span></dt><dt><span class="section"><a href="maintenance.html#weekly">週次</a></span></dt><dt><span class="section"><a href="maintenance.html#monthly">月次</a></span></dt><dt><span class="section"><a href="maintenance.html#quarterly">四半期ごと</a></span></dt><dt><span class="section"><a href="maintenance.html#semiannual">半年ごと</a></span></dt></dl></div><p>これらは、毎時間、日、週、月および年に実行する To Do 項目の簡単な一覧です。これらのタスクは必要なものでも、絶対的なものでもありませんが、役に立つものばかりです。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="hourly"> </a>毎時</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>監視システムのアラートを確認し、それらに対処します。</p></li><li class="listitem"><p>チケットキューの新しいチケットを確認します。</p></li></ul></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="daily"> </a>日次</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>故障または異常になっているインスタンスを確認し、理由を調査します。</p></li><li class="listitem"><p>セキュリティパッチを確認し、必要に応じて適用します。</p></li></ul></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="weekly"> </a>週次</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>クラウドの使用量を確認します: </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>ユーザークォータ</p></li><li class="listitem"><p>ディスク領域</p></li><li class="listitem"><p>イメージ使用量</p></li><li class="listitem"><p>大きなインスタンス</p></li><li class="listitem"><p>ネットワーク使用量 (帯域および IP 使用量)</p></li></ul></div></li><li class="listitem"><p>アラート機能が動作していることを確認します。</p></li></ul></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="monthly"> </a>月次</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>この 1 か月における使用量および傾向を確認します。</p></li><li class="listitem"><p>削除すべきユーザーアカウントを確認します。</p></li><li class="listitem"><p>削除すべきオペレーターアカウントを確認します。</p></li></ul></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="quarterly"> </a>四半期ごと</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>この四半期における使用量および傾向を確認します。</p></li><li class="listitem"><p>使用量と統計に関する四半期レポートを準備します。</p></li><li class="listitem"><p>クラウドの追加の必要性を検討し、計画を立てます。</p></li><li class="listitem"><p>OpenStack のメジャーアップグレードの内容を確認し、その計画を立てます。</p></li></ul></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="semiannual"> </a>半年ごと</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>OpenStack をアップグレードします。</p></li><li class="listitem"><p>OpenStack のアップグレード後に後始末を行います (未使用または新しいサービスを把握していますか?)</p></li></ul></div></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="broken_component"> </a>故障しているコンポーネントの特定</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="maintenance.html#tailing_logs">最新ログの確認</a></span></dt><dt><span class="section"><a href="maintenance.html#daemons_cli">コマンドラインでのデーモンの実行</a></span></dt><dt><span class="section"><a href="maintenance.html#complexity">複雑な例</a></span></dt><dt><span class="section"><a href="maintenance.html#upgrades">アップグレード</a></span></dt></dl></div><p>OpenStack は、異なるコンポーネント同士が互いに強く連携して動作しています。たとえば、イメージのアップロードでは、<code class="code">nova-api</code>, <code class="code">glance-api</code>, <code class="code">glance-registry</code>, Keystone が連携する必要があります。 <code class="code">swift-proxy</code> も関係する場合があります。その結果、時として問題が発生している箇所を正確に特定することが難しくなります。これを支援することがこのセクションの目的です。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="tailing_logs"> </a>最新ログの確認</h3></div></div></div><p>最初に確認する場所は、実行しようとしているコマンドに関連するログファイルです。たとえば、<code class="code">nova list</code> が失敗していれば、Nova ログファイルを tail 表示しながら、次のコマンドを再実行してください。</p><p>端末 1:</p><pre class="programlisting"># tail -f /var/log/nova/nova-api.log</pre><p>端末 2:</p><pre class="programlisting"># nova list</pre><p>何らかのエラーまたはトレースをログファイルで探します。詳細は <span class="bold"><strong>ロギングとモニタリング</strong></span> の章を参照してください。</p><p>エラーから問題が他のコンポーネントにあることが分かる場合には、そのコンポーネントのログファイルに表示を切り替えます。nova が glance にアクセスできなければ、glance-api ログを確認します。</p><p>端末 1:</p><pre class="programlisting"># tail -f /var/log/glance/api.log</pre><p>端末 2:</p><pre class="programlisting"># nova list</pre><p>問題の根本となる原因を見つけるまで、洗い出し、精査し、繰り返します。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="daemons_cli"> </a>コマンドラインでのデーモンの実行</h3></div></div></div><p>残念ながら、ときどきエラーがログファイルに表れない場合があります。このような場合、作戦を変更し、違うコマンドを使用します。おそらくコマンドラインにおいて直接サービスを実行することです。たとえば、<code class="code">glance-api</code> サービスが起動しなかったり、実行状態にとどまらない場合は、コマンドラインからデーモンを起動してみます。</p><pre class="programlisting"># sudo -u glance -H glance-api</pre><p>これにより、エラーと問題の原因が表示されるかもしれません。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../common/images/admon/note.png"/></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>sudo を用いてデーモンを実行するとき、<code class="literal">-H</code> フラグが必要です。いくつかのデーモンは、ユーザーのホームディレクトリーからの相対パスのファイルに書き込みを行うため、<code class="literal">-H</code> がないと、この書き込みが失敗してしまいます。</p></td></tr></table></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="complexity"> </a>複雑な例</h3></div></div></div><p>ある朝、あるノードでインスタンスの実行がすべて失敗するようになりました。ログファイルがすこしあいまいでした。特定のインスタンスが起動できなかったことを示していました。これは最終的に偽の手掛かりであることがわかりました。単にそのインスタンスがアルファベット順で最初のインスタンスだったので、nova-compute が最初に操作したのがそのインスタンスだったというだけでした。</p><p>さらなるトラブルシューティングにより、libvirt がまったく動作していないことがわかりました。これは大きな手がかりです。libvirt が動作していないと、KVM によるインスタンスの仮想化ができません。libvirt を開始させようとしても、libvirt は何も表示せずすぐに停止しました。libvirt のログでは理由がわかりませんでした。</p><p>次に、<code class="code">libvirtd</code> デーモンをコマンドラインにおいて実行しました。最終的に次のような役に立つエラーメッセージが得られました。d-bus に接続できませんでした。このため、滑稽に聞こえるかもしれませんが、libvirt 、その結果として <code class="code">nova-compute</code> も D-Bus に依存していて、どういう訳か D-Bus がクラッシュしました。単に D-Bus を開始するだけで、一連のプログラムがうまく動くようになり、すぐに全部が元に戻り動作状態になりました。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="upgrades"> </a>アップグレード</h3></div></div></div><p>Object Storage 以外では、OpenStack をあるバージョンから別のバージョンへアップグレードするには、非常に労力を伴います。</p><p>一般的に、アップグレード作業は以下の手順で行います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>リリースノートとドキュメントを読みます。</p></li><li class="listitem"><p>異なるバージョン間の非互換性を確認します。</p></li><li class="listitem"><p>アップグレードスケジュールの計画を立て、テストクラスターで手順どおりにアップグレードができることを確認します。</p></li><li class="listitem"><p>アップグレードを実行します。</p></li></ol></div><p>ユーザーのインスタンスが実行中のまま、アップグレードを実行することができます。しかしながら、この方法は危険です。ユーザーに対する適切な通知を忘れないようにしてください。そして、バックアップも忘れないでください。</p><p>最も成功すると考えられる一般的な順番は次のとおりです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>OpenStack Identity サービス (keystone) をアップグレードします。</p></li><li class="listitem"><p>OpenStack Image サービス (glance) をアップグレードします。</p></li><li class="listitem"><p>すべての OpenStack Compute (nova) サービスをアップグレードします。</p></li><li class="listitem"><p>すべての OpenStack Block Storage (cinder) サービスをアップグレードします。</p></li></ol></div><p>これらのステップそれぞれに対して、以下のサブステップを完了します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>サービスを停止します。</p></li><li class="listitem"><p>設定ファイルとデータベースのバックアップを作成します。</p></li><li class="listitem"><p>ディストリビューションのパッケージマネージャーを用いてパッケージをアップグレードします。</p></li><li class="listitem"><p>リリースノートに従って設定ファイルを更新します。</p></li><li class="listitem"><p>データベースのアップグレードを適用します。</p></li><li class="listitem"><p>サービスを再起動します。</p></li><li class="listitem"><p>すべてが正しく動作することを確認します。</p></li></ol></div><p>おそらく、すべて中で最も大切なステップは事前のアップグレードテストです。とくに新しいバージョンのリリース後すぐにアップグレードする場合、未発見のバグによってアップグレードがうまくいかないこともあるでしょう。管理者によっては、最初のアップデート版が出るまで待つことを選ぶ場合もあります。しかしながら、重要な環境の場合には、リリース版の開発やテストに参加することで、あなたのユースケースでのバグを確実に修正することもできるでしょう。</p><p>インスタンスを実行したまま、OpenStack Compute のアップグレードを行うには、ハイパーバイザーの機能のライブマイグレーションを使って、アップグレードを実行している間はインスタンスを他のマシンに移動し、終わったら元のマシンに戻す方法を取ることができます。しかしながら、データベースの更新を確実に行うことが非常に重要です。さもないと、クラスターが一貫性のない状態になってしまいます。</p></div></div></div><script type="text/javascript" src="../common/main.js"><!----></script><hr/><div id="disqus_thread"><script type="text/javascript">
	      if(window.location.protocol.substring(0,4) == 'http'){
	        var disqus_shortname = 'openstack-ops';
	      
	        var disqus_identifier = 'openstack-operations-guidemaintenance';
	      
	      }
	    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script type="text/javascript" src="../common/comments.js"><!----></script></div><hr/><div class="legal"><a href="index.html">Legal notices</a></div></div><div><div id="leftnavigation" style="padding-top:3px; background-color:white;"><div id="tabs"><ul><li><a href="#treeDiv" tabindex="1"><span class="contentsTab">目次</span></a></li><li><a href="#searchDiv" tabindex="1"><span class="searchTab">Search</span></a></li></ul><div id="treeDiv"><img src="../common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"/><div id="ulTreeDiv" style="display:none" class="thisisthat"><ul id="tree" class="filetree"><li tabindex="2"><span class="file"><a href="ch_doc_history.html">ドキュメント変更履歴</a></span></li><li tabindex="2"><span class="file"><a href="section_yk2_jpr_lj.html">はじめに</a></span><ul><li tabindex="2"><span class="file"><a href="section_yk2_jpr_lj.html#chapter_gk2_jpr_lj">この本をなぜ書いたか？どうやって書いたか？</a></span></li><li tabindex="2"><span class="file"><a href="section_yk2_jpr_lj.html#section_gl2_jpr_lj">この本の作成に参加するには</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html">1. プロビジョニングとデプロイメント</a></span><ul><li tabindex="2"><span class="file"><a href="section_arch_provision.html#automated_deploy">自動デプロイメント</a></span><ul><li tabindex="2"><span class="file"><a href="section_arch_provision.html#disk_partition_raid">ディスクのパーティショニングと RAID</a></span></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html#network_config">ネットワーク設定</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html#auto_config">自動環境設定</a></span></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html#remote_mgmt">リモート管理</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html">2. クラウドコントローラーの設計</a></span><ul><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#hardware_consid">ハードウェアの考慮事項</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#separate_services">サービスの分離</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#database">データベース</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#message_queue">メッセージキュー</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#api">Application Programming Interface (API)</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#extensions">API 拡張</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#scheduler">スケジューラー</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#images">イメージ</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#dashboard">ダッシュボード</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#authentication">認証と認可</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#network_consid">ネットワークの考慮事項</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="scaling.html">3. スケーリング</a></span><ul><li tabindex="2"><span class="file"><a href="scaling.html#starting">出発点</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#add_controller_nodes">コントローラーノードの追加</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#segregate_cloud">クラウドの分離</a></span><ul><li tabindex="2"><span class="file"><a href="scaling.html#cells_regions">セルとリージョン</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#availability_zones">アベイラビリティゾーンとホストアグリゲート</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="scaling.html#scalable_hardware">スケーラブルハードウェア</a></span><ul><li tabindex="2"><span class="file"><a href="scaling.html#hardware_procure">ハードウェア調達</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#capacity_planning">キャパシティプランニング</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#burin_testing">エージング試験</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="compute_nodes.html">4. コンピュートノード</a></span><ul><li tabindex="2"><span class="file"><a href="compute_nodes.html#cpu_choice">CPU の選択</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#hypervisor_choice">ハイパーバイザーの選択</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#instance_storage">インスタンスストレージのソリューション</a></span><ul><li tabindex="2"><span class="file"><a href="compute_nodes.html#off_compute_node_storage">コンピュートノード外のストレージ （共有ファイルシステム）</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#on_compute_node_storage">コンピュートノード上のストレージ （共有ファイルシステム）</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#on_compute_node_storage_nonshared">コンピュートノード上のストレージ （非共有ファイルシステム）</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#live_migration">ライブマイグレーションに関する問題</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#file_systems">ファイルシステムの選択</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#overcommit">オーバーコミット</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#logging">ロギング</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#networking">ネットワーク</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="storage_decision.html">5. ストレージ選定</a></span><ul><li tabindex="2"><span class="file"><a href="storage_decision.html#storage_concepts">ストレージのコンセプト</a></span><ul><li tabindex="2"><span class="file"><a href="storage_decision.html#object_storage">オブジェクトストレージ</a></span></li><li tabindex="2"><span class="file"><a href="storage_decision.html#block_storage">ブロックストレージ</a></span></li><li tabindex="2"><span class="file"><a href="storage_decision.html#file_level_storage">ファイルレベルストレージ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="storage_decision.html#storage_backends">ストレージバックエンドの選択</a></span><ul><li tabindex="2"><span class="file"><a href="storage_decision.html#commodity_storage_backends">コモディティハードウェア上の ストレージ技術</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="storage_decision.html#openstack_object_storage">OpenStack Object Storage の注意事項</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="network_design.html">6. ネットワーク設計</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#mgmt_network">管理ネットワーク</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#public_addressing">パブリックアドレスの選択肢</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#ip_address_planning">IP アドレス計画</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#network_topology">ネットワークトポロジー</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#vlans">VLAN</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#multi_nic">マルチNIC</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#multi_host_single_host_networks">マルチホストネットワークとシングルホストネットワーク</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="network_design.html#services_for_networking">ネットワーク関係のサービス</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#ntp">NTP</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#dns">DNS</a></span></li></ul></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="example_architecture.html">7. 参考アーキテクチャ</a></span><ul><li tabindex="2"><span class="file"><a href="example_architecture.html#overview">概要</a></span></li><li tabindex="2"><span class="file"><a href="example_architecture.html#rationale">設定指針</a></span><ul><li tabindex="2"><span class="file"><a href="example_architecture.html#quantum">なぜ OpenStack Networking Service (quantum) を使わないか？</a></span></li><li tabindex="2"><span class="file"><a href="example_architecture.html#multi-host-networking">なぜマルチホストネットワークを使うか？</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="example_architecture.html#detailed_desc">詳細な説明</a></span></li><li tabindex="2"><span class="file"><a href="example_architecture.html#optional_extensions">さらなる拡張</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="whats_next.html">8. 次はどうする？</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html">9. 環境の把握</a></span><ul><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#cli_tools">クライアントコマンドラインツール</a></span><ul><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#install_tools">ツールの導入</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#admin_cli">管理系コマンドラインツール</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#get_creds">認証情報の取得方法</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#cli_tricks">コマンドラインのこつとはまりどころ</a></span><ul><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#curl">cURL</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#servers_services">サーバーとサービス</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#network">ネットワーク</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#users_projects">ユーザーとプロジェクト</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#running_instances">稼働中のインスタンス</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="projects_users.html">10. プロジェクトとユーザーの管理</a></span><ul><li tabindex="2"><span class="file"><a href="projects_users.html#projects_or_tenants">プロジェクトかテナントか?</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#managing_projects">プロジェクトの管理</a></span><ul><li tabindex="2"><span class="file"><a href="projects_users.html#add_projects">プロジェクトの追加</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="projects_users.html#quotas">クォータ</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#user_mgmt">ユーザー管理</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#create_new_users">新規ユーザーの作成</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#associate_users_with_projects">プロジェクトへのユーザーの割り当て</a></span><ul><li tabindex="2"><span class="file"><a href="projects_users.html#customize_auth">権限のカスタマイズ</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#problem_users">他のユーザーに悪影響を与えるユーザー</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="user_facing_operations.html">11. ユーザーによる運用</a></span><ul><li tabindex="2"><span class="file"><a href="user_facing_images.html">イメージ</a></span><ul><li tabindex="2"><span class="file"><a href="user_facing_images.html#add_images">イメージの追加</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#delete_images">イメージの削除</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#other_cli">他の CLI オプション</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#image_service_and_database">イメージサービスおよびデータベース</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#sample_image_database">イメージサービスのデータベースクエリーの例</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="flavors.html">フレーバー</a></span><ul><li tabindex="2"><span class="file"><a href="flavors.html#d6e1980">どのように既存のフレーバーを変更しますか?</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="security_groups.html">セキュリティグループ</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_block_storage.html">ブロックストレージ</a></span><ul><li tabindex="2"><span class="file"><a href="user_facing_block_storage.html#block_storage_creation_failures">ブロックストレージの作成エラー</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="instances.html">インスタンス</a></span><ul><li tabindex="2"><span class="file"><a href="instances.html#start_instances">インスタンスの起動</a></span></li><li tabindex="2"><span class="file"><a href="instances.html#instance_boot_failures">インスタンスの起動失敗</a></span></li><li tabindex="2"><span class="file"><a href="instances.html#instance_specific_data">インスタンス固有のデータ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="associate_security_groups.html">セキュリティグループの割り当て</a></span></li><li tabindex="2"><span class="file"><a href="floating_ips.html">Floating IP</a></span></li><li tabindex="2"><span class="file"><a href="attach_block_storage.html">ブロックストレージの接続</a></span></li><li tabindex="2"><span class="file"><a href="snapsnots.html">スナップショットの取得</a></span><ul><li tabindex="2"><span class="file"><a href="snapsnots.html#consistent_snapshots">スナップショットの一貫性の保証</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="database_instances.html">データベースにあるインスタンス</a></span></li></ul></li><li tabindex="2" id="webhelp-currentid"><span class="file"><a href="maintenance.html">12. メンテナンス、故障およびデバッグ</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#cloud_controller_storage">クラウドコントローラーとストレージプロキシの故障とメンテナンス</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#planned_maintenance">計画メンテナンス</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#reboot_cloud_controller">クラウドコントローラーとストレージプロキシの再起動</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#after_a_cc_reboot">クラウドコントローラーまたはストレージプロキシの再起動後</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#cc_failure">全体的なクラウドコントローラーの故障</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#compute_node_failures">コンピュートノードの故障とメンテナンス</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#planned_maintenance_compute_node">計画メンテナンス</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#after_compute_node_reboot">コンピュートノードの再起動後</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#maintenance_instances">インスタンス</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#inspect_and_recover_failed_instances">故障したインスタンスからの検査とデータ復旧</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#volumes">ボリューム</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#totle_compute_node_failure">コンピュートノード全体の故障</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#var_lib_nova_instances">/var/lib/nova/instances</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#storage_node_failures">ストレージノードの故障とメンテナンス</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#reboot_storage_node">ストレージノードの再起動</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#shut_down_storage_node">ストレージノードのシャットダウン</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#replace_swift_disk">Swift ディスクの交換</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#complete_failure">完全な故障の対処</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#config_mgmt">構成管理</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#hardware">ハードウェアの取り扱い</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#add_new_node">コンピュートノードの追加</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#add_new_object_node">オブジェクトストレージノードの追加</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#replace_components">コンポーネントの交換</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#databases">データベース</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#database_connect">データベース接続性</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#perf_and_opt">パフォーマンスと最適化</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#hdmy">HDWMY</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#hourly">毎時</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#daily">日次</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#weekly">週次</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#monthly">月次</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#quarterly">四半期ごと</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#semiannual">半年ごと</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#broken_component">故障しているコンポーネントの特定</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#tailing_logs">最新ログの確認</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#daemons_cli">コマンドラインでのデーモンの実行</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#complexity">複雑な例</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#upgrades">アップグレード</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html">13. ネットワークのトラブルシューティング</a></span><ul><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#check_interface_states">「ip a」を使ってインタフェース状態をチェックする</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#network_traffic_in_cloud">クラウド上のネットワークトラフィック</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#failure_in_path">経路上の障害を見つける</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#tcpdump">tcpdump</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#iptables">iptables</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#network_config_database">データベースにあるネットワーク設定</a></span><ul><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#deassociate_floating_ip">手動でフローティングIPの関連付けを解除する</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#debug_dhcp_issues">DHCP の問題をデバッグする</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#debugging_dns_issues">DNS の問題をデバッグする</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html">14. ロギングと監視</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#where_are_logs">ログはどこにあるのか？</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#cloud_controller_ops">クラウドコントローラー</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#compute_nodes_ops">コンピュートノード</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#block_storage_nodes">ブロックストレージ ノード</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#how_to_read_logs">ログの読み方</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#tracing_instance_request">インスタンスリクエストの追跡</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#add_custom_logging">カスタムログの追加</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#rabbitmq">RabbitMQ Web管理インターフェイス および rabbitmqctl</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#manage_logs_centrally">ログの集中管理</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#rsyslog_client_config">rsyslog クライアント設定</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#rsyslog_server_config">rsyslog サーバー設定</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#stacktach">StackTach</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#monitoring">監視</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#process_monitoring">プロセス監視</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#resource_alerting">リソースのアラート</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#os_resources">OpenStack固有のリソース</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#intelligent_alerting">インテリジェントなアラート</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#trending">トレンド</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html">15. バックアップとリカバリー</a></span><ul><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#what_to_backup">バックアップ対象</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#database_backups">データベースのバックアップ</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#file_system_backups">ファイルシステムバックアップ</a></span><ul><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#compute">コンピュート</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#image_catalog_delivery">イメージカタログと配布</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#identity">認証</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#ops_block_storage">ブロックストレージ</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#ops_object_storage">オブジェクトストレージ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#recovering_backups">バックアップのリカバリー</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="customize.html">16. カスタマイズ</a></span><ul><li tabindex="2"><span class="file"><a href="customize.html#devstack">DevStack</a></span></li><li tabindex="2"><span class="file"><a href="customize.html#middleware_example">ミドルウェア例</a></span></li><li tabindex="2"><span class="file"><a href="customize.html#nova_scheduler_example">Nova スケジューラーの例</a></span></li><li tabindex="2"><span class="file"><a href="customize.html#ops_dashboard">ダッシュボード</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html">17. OpenStack コミュニティ</a></span><ul><li tabindex="2"><span class="file"><a href="upstream_openstack.html#get_help">助けを得る</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#report_bugs">バグ報告</a></span><ul><li tabindex="2"><span class="file"><a href="upstream_openstack.html#confirm_priority">バグの確認と優先付け</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#bug_fixing">バグ修正</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#after_change_is_accepted">変更が受理された後</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#openstack_community">OpenStack コミュニティに参加する</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#features">機能と開発ロードマップ</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#contribute_to_docs">ドキュメント作成への貢献の仕方</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#security_info">セキュリティ情報</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#additional_info">さらに情報を見つける</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="use-cases.html">A. 事例</a></span><ul><li tabindex="2"><span class="file"><a href="nectar.html">NeCTAR</a></span><ul><li tabindex="2"><span class="file"><a href="nectar_deploy.html">デプロイ</a></span></li><li tabindex="2"><span class="file"><a href="nectar_resources.html">リソース</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="mit_csail.html">MIT CSAIL</a></span><ul><li tabindex="2"><span class="file"><a href="mit_csail_deploy.html">デプロイ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="dair.html">DAIR</a></span><ul><li tabindex="2"><span class="file"><a href="dair_deploy.html">デプロイ</a></span></li><li tabindex="2"><span class="file"><a href="dair_resources.html">リソース</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="cern.html">CERN</a></span><ul><li tabindex="2"><span class="file"><a href="cern_deploy.html">デプロイ</a></span></li><li tabindex="2"><span class="file"><a href="cern_resources.html">リソース</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="app_crypt.html">B. ハリウッド^H^H^H^H^Hクラウドナイトメア</a></span><ul><li tabindex="2"><span class="file"><a href="double_vlan.html">ダブル VLAN</a></span></li><li tabindex="2"><span class="file"><a href="issue.html">「あの問題」</a></span></li><li tabindex="2"><span class="file"><a href="disappear_images.html">イメージの消失</a></span></li><li tabindex="2"><span class="file"><a href="valentines.html">バレンタインデーのコンピュートノード大虐殺</a></span></li><li tabindex="2"><span class="file"><a href="rabbithole.html">ウサギの穴に落ちて</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="recommended-reading.html">C. リソース</a></span></li><li tabindex="2"><span class="file"><a href="go01.html">用語集</a></span></li></ul></div></div><div id="searchDiv"><div id="search"><form onsubmit="Verifie(ditaSearch_Form);return false" name="ditaSearch_Form" class="searchForm"><fieldset class="searchFieldSet"><legend>Search</legend><center><input id="textToSearch" name="textToSearch" type="text" class="searchText"/> &nbsp; <input onclick="Verifie(ditaSearch_Form)" type="button" class="searchButton" value="Go" id="doSearch"/></center></fieldset></form></div><div id="searchResults"><center/></div><p class="searchHighlight"><a href="#" onclick="toggleHighlight()">Search Highlighter (On/Off)</a></p></div></div></div></div><script type="text/javascript" src="../common/jquery/jquery.qtip-1.0.0-rc3/jquery.qtip-1.0.0-rc3.min.js"><!--jQuery plugin for glossary popups. -->
                   $('a[title]').qtip({ style: { name: 'cream', tip: true } })
                </script></body></html>