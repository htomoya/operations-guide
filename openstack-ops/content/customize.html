<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#"><head>
<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css"/><script type="text/javascript" src="scripts/shCore.js"><!----></script><script type="text/javascript">
               SyntaxHighlighter.config.space = ' ';
               SyntaxHighlighter.all();
    </script>
<title>第16章 カスタマイズ - OpenStack 運用ガイド</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><meta name="mavenGroupId" content="org.openstack.docs"/><meta name="mavenArtifactId" content="openstack-ops-manual"/><meta name="mavenVersionId" content="1.0.0"/><link rel="home" href="index.html" title="OpenStack 運用ガイド"/><link rel="up" href="index.html" title="OpenStack 運用ガイド"/><link rel="prev" href="backup_and_recovery.html" title="第15章 バックアップとリカバリー"/><link rel="next" href="upstream_openstack.html" title="第17章 OpenStack コミュニティ"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-10646";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Your browser is not supported. Use of Mozilla Firefox is recommended.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
        </script><style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
            
        </style><link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"/><link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/><link rel="stylesheet" type="text/css" href="../common/css/custom.css"/><!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
	<![endif]--><link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/><link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/><script type="text/javascript" src="../common/jquery/jquery-1.4.3.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script><script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery.qtip-1.0.0-rc3/jquery.qtip-1.0.0-rc3.min.js"><!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script><script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script><script type="text/javascript" src="search/nwSearchFnt.js"><!----></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"><!--//make this scalable to other languages as well.--></script><script type="text/javascript" src="search/index-1.js"><!----></script><script type="text/javascript" src="search/index-2.js"><!----></script><script type="text/javascript" src="search/index-3.js"><!----></script><script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
	        </script><script type="text/javascript" src="../common/ga.js"><!----></script></head><body><div id="header"><a onclick="_gaq.push(['_trackEvent', 'Header', 'logo', 'click', 1]);" target="_blank" href="http://www.openstack.org"><img src="../common/images/openstack-logo.png" alt="OpenStack Documentation" width="157" height="47"/></a><h1>第16章 カスタマイズ</h1><div id="navheader" align="right"><!----><table class="navLinks"><tr><td><a id="showHideButton" onclick="showHideToc(); _gaq.push(['_trackEvent', 'Header', 'show/hide', 'click', 1]);" class="pointLeft" title="Hide TOC tree">Sidebar
                            </a></td><td><a accesskey="p" class="navLinkPrevious" onclick="_gaq.push(['_trackEvent', 'Header', 'prevLink', 'click', 1]);" tabindex="5" href="backup_and_recovery.html">戻る</a> 
				  |
                                    <a accesskey="n" class="navLinkNext" onclick="_gaq.push(['_trackEvent', 'Header', 'nextLink', 'click', 1]);" tabindex="5" href="upstream_openstack.html">次へ</a></td></tr></table></div></div><div id="toolbar" class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"><div id="toolbar-left"><p class="breadcrumbs"><a href="http://docs.openstack.org/">OpenStack Manuals</a><a href="index.html">OpenStack 運用ガイド</a></p><a onclick="_gaq.push(['_trackEvent', 'Header', 'pdfDownload', 'click', 1]);" alt="Download a pdf of this document" class="pdficon" href="../openstack-ops-manual-local.pdf"><img src="../common/images/pdf.png"/></a></div></div><div id="content"><div class="statustext"> </div><div xml:lang="ja" class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="customize"> </a>第16章 カスタマイズ</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="customize.html#devstack">DevStack</a></span></dt><dt><span class="section"><a href="customize.html#middleware_example">ミドルウェア例</a></span></dt><dt><span class="section"><a href="customize.html#nova_scheduler_example">Nova スケジューラーの例</a></span></dt><dt><span class="section"><a href="customize.html#ops_dashboard">Dashboard</a></span></dt></dl></div><p>OpenStack はあなたが必要とするすべてのことをしてくれるわけではないかもしれません。この場合、主に2つのやり方のうちのいずれかに従ってください。まず最初に、<a class="link" href="https://wiki.openstack.org/wiki/How_To_Contribute" target="_top">貢献するには</a> (https://wiki.openstack.org/wiki/How_To_Contribute) を学び、<a class="link" href="https://wiki.openstack.org/wiki/GerritWorkflow" target="_top">Code Review Workflow</a> (https://wiki.openstack.org/wiki/GerritWorkflow) に従って、あなたの修正を上流の OpenStack プロジェクトへコントリビュートしてください。もし、あなたが必要な機能が既存のプロジェクトと密にインテグレーションする必要がある場合、これが推奨される選択肢です。コミュニティは、いつでも貢献に対して開かれていますし、機能開発ガイドラインに従う新機能を歓迎します。</p><p>代替え案としては、もしあなたが必要とする機能が密なインテグレーションを必要としないのであれば、OpenStack をカスタマイズする他の方法があります。もし、あなたの機能が必要とされるプロジェクトが Python Paste フレームワークを使っているのであれば、そのための ミドルウェアを作成し、環境設定を通じて組み込めばよいのです。例えば OpenStack Compute の新しいスケジューラーや、カスタマイズされたダッシュボードを作成するといった、プロジェクトをカスタマイズする特定の方法もあるかもしれません。この章では、OpenStack をカスタマイズする後者の方法にフォーカスします。</p><p>OpenStack をこの方法でカスタマイズするためには、開発環境が必要です。開発環境を手軽に動作させる最良の方法は、クラウドの中で DevStack を動かすことです。</p><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="devstack"> </a>DevStack</h2></div></div></div><p>ドキュメンテーションはすべて <a class="link" href="http://devstack.org/" target="_top">DevStack</a> (http://devstack.org/) のウェブサイトにあります。 どのプロジェクトをカスタマイズしたいかによって、つまり Object Storage (swift) なのか他のプロジェクトなのかによって、DevStack の環境設定が異なります。以下のミドルウェアの例では、Object Storage を有効にしてインストールしなければなりません。</p><div class="procedure"><a id="d6e3238"> </a><p class="title"><strong>インスタンス上で、Folsom の安定版用の DevStack を動作させるためには：</strong></p><ol class="procedure" type="1"><li class="step"><p>ダッシュボード、または nova のコマンドラインインタフェース(CLI)から、以下のパラメータでインスタンスを起動してください。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>名前: devstack</p></li><li class="listitem"><p>イメージ: Ubuntu 12.04 LTS</p></li><li class="listitem"><p>メモリサイズ: 4 GB RAM (おそらく 2 GB でもなんとかなるでしょう)</p></li><li class="listitem"><p>ディスクサイズ: 最低 5 GB</p></li></ul></div><p><code class="code">nova</code> コマンドを使っているのであれば、適切なメモリ量とディスクサイズを得るために <code class="code">nova boot</code> コマンドに <code class="code">--flavor 6</code> を指定してください。</p></li><li class="step"><p>利用するイメージで root ユーザしか使えない場合、stack ユーザを作成しなければなりません。でなければ、<code class="code">stack.sh</code> スクリプトに stack ユーザを作成させる時に、screen に関するパーミッションの問題にぶつかります。利用するイメージに、既に root 以外のユーザがあるのであれば、このステップは省略できます。</p><ol type="a" class="substeps"><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">ssh root@&lt;IP Address&gt;</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">adduser --gecos "" stack</pre><p>
                        </p></li><li class="step"><p>プロンプトに対して新しいパスワードを入力します。</p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">adduser stack sudo</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">grep -q
                                "^#includedir.*/etc/sudoers.d"
                                /etc/sudoers || echo "#includedir
                                /etc/sudoers.d" &gt;&gt;
                                /etc/sudoers</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">( umask 226 &amp;&amp; echo "stack
                                ALL=(ALL) NOPASSWD:ALL" &gt;
                                /etc/sudoers.d/50_stack_sh )</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">exit</pre><p>
                        </p></li></ol></li><li class="step"><p>stack ユーザとしてログインし、DevStack の設定を行います。</p><ol type="a" class="substeps"><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">ssh stack@&lt;IP address&gt;</pre><p>
                        </p></li><li class="step"><p>プロンプトに対して、stack ユーザに作ったパスワードを入力します。</p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">sudo apt-get -y update</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">sudo apt-get -y install git</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">git clone
                                https://github.com/openstack-dev/devstack.git -b
                                stable/folsom devstack/</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">cd devstack</pre><p>
                        </p></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">vim localrc</pre><p>
                            </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Swift のみ、<span class="bold"><strong>ミドルウェア例</strong></span> で使用された, 以下の <span class="bold"><strong>[1] Swift only localrc</strong></span> の例を参照してください。</p></li><li class="listitem"><p>他のすべてのプロジェクトについて、 <span class="bold"><strong>Nova Scheduler Example</strong></span> で使用された, 以下の <span class="bold"><strong>[2] All other projects localrc</strong></span> の例を参照してください。</p></li></ul></div></li><li class="step"><p>
                            </p><pre class="programlisting brush: bash; ">./stack.sh</pre><p>
                        </p></li><li class="step"><pre class="programlisting brush: bash; ">screen -r stack</pre><p> </p></li></ol><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../common/images/admon/note.png"/></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">stack.sh</code> の実行には、しばらく時間がかかります。できれば、この時間を使って <a class="link" href="http://www.openstack.org/join/" target="_top">OpenStack ファウンデーションに参加</a>してください (http://www.openstack.org/join/)。</p></li><li class="listitem"><p><code class="code">stack.sh</code> を実行する際、“ERROR: at least one RPC back-end must be enabled” というエラーメッセージが出るかもしれません。これは心配しないでください。swift と keystone はRPC (AMQP) バックエンドを必要としないのです。同様に、<code class="code">ImportErrors</code> はすべて無視できます。</p></li><li class="listitem"><p>Screen は、多くの関連するサービスを同時に見るための便利なプログラムです。<a class="link" href="http://aperiodic.net/screen/quick_reference" target="_top">GNU screen quick reference</a>. (http://aperiodic.net/screen/quick_reference) を参照してください。</p></li></ul></div></td></tr></table></div></li></ol></div><p>以上で OpenStack の開発環境を準備できましたので、運用環境にダメージを与えることを心配せずに自由にハックできます。Swift のみの環境では <span class="bold"><strong>ミドルウェア例</strong></span> に、‘他のすべてのプロジェクトでは <span class="bold"><strong>Nova Scheduler Example</strong></span> に進んでください。</p><p>
            <span class="bold"><strong>[1] Swift only localrc</strong></span>
        </p><pre class="programlisting brush: bash; ">ADMIN_PASSWORD=devstack
MYSQL_PASSWORD=devstack
RABBIT_PASSWORD=devstack
SERVICE_PASSWORD=devstack
SERVICE_TOKEN=devstack 
            
SWIFT_HASH=66a3d6b56c1f479c8b4e70ab5c2000f5
SWIFT_REPLICAS=1 
            
# Uncomment the BRANCHes below to use stable versions
            
            
# unified auth system (manages accounts/tokens)
KEYSTONE_BRANCH=stable/folsom</pre><pre class="programlisting brush: bash; "># object storage
SWIFT_BRANCH=stable/folsom 
            
disable_all_services
enable_service key swift mysql</pre><p>
            <span class="bold"><strong>[2] All other projects localrc</strong></span>
        </p><pre class="programlisting brush: bash; ">ADMIN_PASSWORD=devstack
MYSQL_PASSWORD=devstack
RABBIT_PASSWORD=devstack
SERVICE_PASSWORD=devstack
SERVICE_TOKEN=devstack 
            
FLAT_INTERFACE=br100
PUBLIC_INTERFACE=eth0
            
VOLUME_BACKING_FILE_SIZE=20480M 
            
# For stable versions, look for branches named stable/[milestone]. 
            
# compute service
NOVA_BRANCH=stable/folsom 
            
# volume service
CINDER_BRANCH=stable/folsom 
            
# image catalog service
GLANCE_BRANCH=stable/folsom 
            
# unified auth system (manages accounts/tokens)
KEYSTONE_BRANCH=stable/folsom 
            
# django powered web control panel for openstack
HORIZON_BRANCH=stable/folsom</pre></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="middleware_example"> </a>ミドルウェア例</h2></div></div></div><p>ほとんどの OpenStack プロジェクトは Python <a class="link" href="http://pythonpaste.org/" target="_top">Paste</a>(http://pythonpaste.org/) フレームワークに基づいています。<a class="link" href="http://pythonpaste.org/do-it-yourself-framework.html" target="_top">A Do-It-Yourself Framework</a> (http://pythonpaste.org/do-it-yourself-framework.html) は、このアーキテクチャの最良の紹介です。このフレームワークを使っているため、コードに一切手をいれずに、プロジェクトの処理パイプラインになんらかのカスタム・コードを入れて機能追加を行うことができます。</p><p>このように OpenStack をカスタマイズすることを説明するため、Swift 用に、あるコンテナに対して、そのコンテナのメタデータで指定される一群のIPアドレスのみからアクセスできるようにするミドルウェアを作成してみます。このような例は多くの状況で有用です。例えば、一般アクセス可能なコンテナを持っていますが、実際に行いたいことはホワイトリストに基づいた一群のIPアドレスにのみ制限したい場合です。</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="../common/images/admon/warning.png"/></td><th align="left">警告</th></tr><tr><td align="left" valign="top"><p>この例は実証目的のみのためにあります。さらなる作りこみと広範なセキュリティテストなしにコンテナのIPホワイトリスト・ソリューションとして使用するべきではありません。</p></td></tr></table></div><p><code class="code">stack.sh</code> が <code class="code">screen -r stack</code> で作成したセッションに join すると、Swift インストール用の localrc を使ったのであれば、3つの screen セッションが見えます。</p><pre class="programlisting brush: bash; ">0$ shell*  1$ key  2$ swift</pre><p>* (アスタリスク)は、どの screen にいるのかを示します。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong><code class="code">0$ shell</code></strong></span>. 何か作業することができる shell セッションです。</p></li><li class="listitem"><p><span class="bold"><strong><code class="code">1$ key</code></strong></span>. keystone サービス。</p></li><li class="listitem"><p><span class="bold"><strong><code class="code">2$ swift</code></strong></span>. swift プロキシサービス。</p></li></ul></div><div class="procedure"><a id="d6e3367"> </a><p class="title"><strong>ミドルウェアを作成して Paste の環境設定を通して組み込むためには：</strong></p><ol class="procedure" type="1"><li class="step"><p>すべての OpenStack のコードは <code class="code">/opt/stack</code> にあります。shell セッションの screen の中で swift ディレクトリに移動し、あなたのミドルウェアモジュールを編集してください。</p><ol type="a" class="substeps"><li class="step"><p>
                            <code class="code">cd /opt/stack/swift</code>
                        </p></li><li class="step"><p>
                            <code class="code">vim swift/common/middleware/ip_whitelist.py</code>
                        </p></li></ol></li><li class="step"><p>以下のコードをコピーしてください。作業が終わったら、ファイルを保存して閉じてください。</p><pre class="programlisting brush: bash; "># Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
                     
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
# implied.
# See the License for the specific language governing permissions and
# limitations under the License.
import socket
 
from swift.common.utils import get_logger
from swift.proxy.controllers.base import get_container_info
from swift.common.swob import Request, Response
 
class IPWhitelistMiddleware(object):
"""
IP Whitelist Middleware
 
Middleware that allows access to a container from only a set of IP
addresses as determined by the container's metadata items that start
with the prefix 'allow'. E.G. allow-dev=192.168.0.20
"""
 
def __init__(self, app, conf, logger=None):
self.app = app
 
if logger:
self.logger = logger
else:
self.logger = get_logger(conf, log_route='ip_whitelist')
 
self.deny_message = conf.get('deny_message', "IP Denied")
self.local_ip = socket.gethostbyname(socket.gethostname())
 
def __call__(self, env, start_response):
"""
WSGI entry point.
Wraps env in swob.Request object and passes it down.
 
:param env: WSGI environment dictionary
:param start_response: WSGI callable
"""
req = Request(env)
 
try:
 version, account, container, obj = req.split_path(1, 4, True)
 except ValueError:
 return self.app(env, start_response)
 
 container_info = get_container_info(
 req.environ, self.app, swift_source='IPWhitelistMiddleware')
 
 remote_ip = env['REMOTE_ADDR']
 self.logger.debug(_("Remote IP: %(remote_ip)s"),
 {'remote_ip': remote_ip})
 
 meta = container_info['meta']
 allow = {k:v for k,v in meta.iteritems() if k.startswith('allow')}
 allow_ips = set(allow.values())
 allow_ips.add(self.local_ip)
 self.logger.debug(_("Allow IPs: %(allow_ips)s"),
 {'allow_ips': allow_ips})
 
 if remote_ip in allow_ips:
 return self.app(env, start_response)
 else:
 self.logger.debug(
 _("IP %(remote_ip)s denied access to Account=%(account)s "
 "Container=%(container)s. Not in %(allow_ips)s"), locals())
 return Response(
 status=403,
 body=self.deny_message,
 request=req)(env, start_response)
 
 
 def filter_factory(global_conf, **local_conf):
 """
 paste.deploy app factory for creating WSGI proxy apps.
 """
 conf = global_conf.copy()
 conf.update(local_conf)
 
 def ip_whitelist(app):
 return IPWhitelistMiddleware(app, conf)
 return ip_whitelist
                 </pre><p><code class="code">env</code> と <code class="code">conf</code> には、リクエストについて何をするのか判断するのに使える有用な情報が多数含まれています。どんなプロパティが利用可能なのかを知るには、以下のログ出力文を <code class="code">__init__</code> メソッドに挿入してください。</p><pre class="programlisting brush: bash; ">self.logger.debug(_("conf = %(conf)s"), locals())</pre><p>そして以下のログ出力分を <code class="code">__call__</code> メソッドに挿入してください。</p><pre class="programlisting brush: bash; ">self.logger.debug(_("env = %(env)s"), locals())</pre></li><li class="step"><p>このミドルウェアを Swift のパイプラインに組み込むには、設定ファイルを1つ編集する必要があります。</p><pre class="programlisting brush: bash; "> vim /etc/swift/proxy-server.conf</pre></li><li class="step"><p><code class="code">[filter:ratelimit]</code> セクションを探し、以下の環境定義セクションを貼り付けてください。</p><pre class="programlisting brush: bash; ">[filter:ip_whitelist]
paste.filter_factory = swift.common.middleware.ip_whitelist:filter_factory
# You can override the default log routing for this filter here:
# set log_name = ratelimit
# set log_facility = LOG_LOCAL0
# set log_level = INFO
# set log_headers = False
# set log_address = /dev/log
deny_message = You shall not pass!</pre></li><li class="step"><p><code class="code">[pipeline:main]</code> セクションを探し、このように <code class="code">ip_whitelist</code> リストを追加してください。完了したら、ファイルを保存して閉じてください。</p><pre class="programlisting brush: bash; ">[pipeline:main]
pipeline = catch_errors healthcheck cache ratelimit ip_whitelist authtoken keystoneauth proxy-logging proxy-server</pre></li><li class="step"><p>Swift にこのミドルウェアを使わせるために、Swift プロキシサービスを再起動します。swift の screen セッションに切り替えてはじめてください。</p><ol type="a" class="substeps"><li class="step"><p>Ctrl-A の後で 2 を押します。ここで、2 は screen セッションのラベルです。Ctrl-A の後で n を押し、次の screen セッションに切り替えることもできます。</p></li><li class="step"><p>Ctrl-C を押し、サービスを終了させます。</p></li><li class="step"><p>上矢印キーを押し、最後のコマンドを表示させます。</p></li><li class="step"><p>Enter キーを押し、実行します。</p></li></ol></li><li class="step"><p>Swift の CLI でミドルウェアのテストをしてください。shell の screen セッションに切り替えてテストを開始し、swift の screen セッションにもどってログ出力をチェックして終了します。</p><ol type="a" class="substeps"><li class="step"><p>Ctrl-A の後で 0 を押します。</p></li><li class="step"><p>
                            <code class="code">cd ~/devstack</code>
                        </p></li><li class="step"><p>
                            <code class="code">source openrc</code>
                        </p></li><li class="step"><p>
                            <code class="code">swift post middleware-test</code>
                        </p></li><li class="step"><p>Ctrl-A の後で 2 を押します。</p></li></ol></li><li class="step"><p>ログの中に以下の行があるでしょう。</p><pre class="programlisting brush: bash; ">proxy-server ... IPWhitelistMiddleware
proxy-server Remote IP: 203.0.113.68 (txn: ...)
proxy-server Allow IPs: set(['203.0.113.68']) (txn: ...)</pre><p>基本的に、最初の３行はこのミドルウェアが Swift の他のサービスとやりとりする際に、再度認証を行う必要がないことを示しています。最後の２行は、このミドルウェアによって出力されており、リクエストが DevStack インスタンスから送られており、許可されていることを示しています。</p></li><li class="step"><a id="test_middleware_step"> </a><p> DevStack 環境の外の、DevStack 用インスタンスにアクセス可能なリモートマシンからミドルウェアをテストします。</p><ol type="a" class="substeps"><li class="step"><p>
                            <code class="code">swift --os-auth-url=http://203.0.113.68:5000/v2.0/ --os-region-name=RegionOne --os-username=demo:demo --os-password=devstack list middleware-test</code>
                        </p></li><li class="step"><p>Container GET failed: http://203.0.113.68:8080/v1/AUTH_.../middleware-test?format=json 403 Forbidden   You shall not pass!</p></li></ol></li><li class="step"><p>再び Swift のログをチェックすると、以下の行が見つかるでしょう。</p><pre class="programlisting brush: bash; ">proxy-server Invalid user token - deferring reject downstream
proxy-server Authorizing from an overriding middleware (i.e: tempurl) (txn: ...)
proxy-server ... IPWhitelistMiddleware
proxy-server Remote IP: 198.51.100.12 (txn: ...)
proxy-server Allow IPs: set(['203.0.113.68']) (txn: ...)
proxy-server IP 198.51.100.12 denied access to Account=AUTH_... Container=None. Not in set(['203.0.113.68']) (txn: ...)</pre><p>ここで、リモートIPアドレスが、許可されたIPアドレスの中になかったため、リクエストが拒否されていることがわかります。</p></li><li class="step"><p>DevStack用インスタンスに戻り、リモートマシンからのリクエストを許可するようなコンテナのメタデータを追加します。</p><ol type="a" class="substeps"><li class="step"><p>Ctrl-A の後で 0 を押します。</p></li><li class="step"><p><code class="code">swift post --meta allow-dev:198.51.100.12 middleware-test</code>
                        </p></li></ol></li><li class="step"><p><a class="xref" href="customize.html#test_middleware_step" title="ステップ 9">ステップ 9</a> に記載したコマンドをもう一度試すと、今度は成功します。</p></li></ol></div><p>このような機能試験は、正しいユニットテストと結合テストの代わりになるものではありませんが、作業を開始することはできます。</p><p>Python Paste フレームワークを使う他のすべてのプロジェクトで、類似のパターンに従うことができます。単純にミドルウェアモジュールを作成し、環境定義によって組み込んでください。そのミドルウェアはプロジェクトのパイプラインの一部として順番に実行され、必要に応じて他のサービスを呼び出します。プロジェクトのコア・コードは一切修正しません。Paste を使っているプロジェクトを確認するには、<code class="code">/etc/&lt;project&gt;</code> に格納されている、プロジェクトの <code class="code">conf</code> または <code class="code">ini</code> 環境定義ファイルの中で　<code class="code">pipeline</code> 変数を探してください。</p><p>あなたのミドルウェアが完成したら、オープンソースにし、OpenStack メーリングリストでコミュニティに知らせることを薦めます。コミュニティの人々はあなたのコードを使い、フィードバックし、おそらくコントリビュートするでしょう。もし十分な支持があれば、公式なSwift <a class="link" href="https://github.com/openstack/swift/tree/master/swift/common/middleware" target="_top">ミドルウェア</a> (https://github.com/openstack/swift/tree/master/swift/common/middleware) に追加するように提案することもできるでしょう。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="nova_scheduler_example"> </a>Nova スケジューラーの例</h2></div></div></div><p>多くの OpenStack のプロジェクトでは、ドライバ・アーキテクチャを使うことによって、特定の機能をカスタマイズすることができます。特定のインターフェースに適合するドライバを書き、環境定義によって組み込むことができます。例えば、簡単に nova に新しいスケジューラーを組み込むことができます。nova の既存のスケジューラーは、フル機能であり、<a class="link" href="http://docs.openstack.org/folsom/openstack-compute/admin/content/ch_scheduling.html" target="_top">スケジューリング</a> (http://docs.openstack.org/folsom/openstack-compute/admin/content/ch_scheduling.html) によくドキュメントされています。しかし、あなたのユーザのユース・ケースに依存して、既存のスケジューラで要件が満たせないかもしれません。この場合は、新しいスケジューラーを作成する必要があるでしょう。</p><p>スケジューラーを作成するには、<code class="code">nova.scheduler.driver.Scheduler</code> クラスを継承しなければなりません。オーバーライド可能な５つのメソッドのうち、以下の "*" で示される２つのメソッドをオーバーライド<span class="emphasis"><em>しなければなりません</em></span>。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <code class="code">update_service_capabilities</code>
                </p></li><li class="listitem"><p>
                    <code class="code">hosts_up</code>
                </p></li><li class="listitem"><p>
                    <code class="code">schedule_live_migration</code>
                </p></li><li class="listitem"><p>* <code class="code">schedule_prep_resize</code></p></li><li class="listitem"><p>* <code class="code">schedule_run_instance</code></p></li></ul></div><p>OpenStack のカスタマイズをデモするために、リクエストの送信元IPアドレスとホスト名のプレフィックスに基づいてインスタンスを一部のホストにランダムに配置するようなNova のスケジューラーの例を作成します。この例は、１つのユーザのグループが１つのサブネットにおり、インスタンスをホスト群の中の一部のサブネットで起動したい場合に有用です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../common/images/admon/note.png"/></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>この例は実証目的のみのためにあります。さらなる作りこみと広範なテストなしにNovaのスケジューラーとして使用するべきではありません。</p></td></tr></table></div><p><code class="code">stack.sh</code> が <code class="code">screen -r stack</code> で作成したセッションに join すると、多数の screen セッションが見えます。</p><pre class="programlisting">0$ shell*  1$ key  2$ g-reg  3$ g-api  4$ n-api  5$ n-cpu  6$ n-crt  7$ n-net  8-$ n-sch ...</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong><code class="code">0$ shell</code></strong></span>. 何か作業することができる shell セッションです。</p></li><li class="listitem"><p><span class="bold"><strong><code class="code">1$ key</code></strong></span>. keystone サービス。</p></li><li class="listitem"><p><span class="bold"><strong><code class="code">g-*</code></strong></span>. glance サービス。</p></li><li class="listitem"><p><span class="bold"><strong><code class="code">n-*</code></strong></span>. nova サービス。</p></li><li class="listitem"><p><span class="bold"><strong><code class="code">n-sch</code></strong></span>。nova スケジューラーサービス。</p></li></ul></div><div class="procedure"><a id="d6e3515"> </a><p class="title"><strong>スケジューラーを作成して、設定を通して組み込むためには：</strong></p><ol class="procedure" type="1"><li class="step"><p>OpenStack のコードは <code class="code">/opt/stack</code> にあるので、nova ディレクトリに移動してあなたのスケジューラーモジュールを編集します。</p><ol type="a" class="substeps"><li class="step"><p>
                            <code class="code">cd /opt/stack/nova</code>
                        </p></li><li class="step"><p>
                            <code class="code">vim nova/scheduler/ip_scheduler.py</code>
                        </p></li></ol></li><li class="step"><p>以下のコードをコピーしてください。作業が終わったら、ファイルを保存して閉じてください。</p><pre class="programlisting"># vim: tabstop=4 shiftwidth=4 softtabstop=4
# Copyright (c) 2013 OpenStack Foundation
# All Rights Reserved.
#
#    Licensed under the Apache License, Version 2.0 (the "License"); you may
#    not use this file except in compliance with the License. You may obtain
#    a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
#    License for the specific language governing permissions and limitations
#    under the License.

"""
IP Scheduler implementation
"""

import random

from nova import exception
from nova.openstack.common import log as logging
from nova import flags
from nova.scheduler import driver

FLAGS = flags.FLAGS
LOG = logging.getLogger(__name__)


class IPScheduler(driver.Scheduler):
"""
Implements Scheduler as a random node selector based on 
IP address and hostname prefix.
 """

def _filter_hosts(self, hosts, hostname_prefix):
"""Filter a list of hosts based on hostname prefix."""

hosts = [host for host in hosts if host.startswith(hostname_prefix)]
return hosts

def _schedule(self, context, topic, request_spec, filter_properties):
 """
Picks a host that is up at random based on 
IP address and hostname prefix.
"""

elevated = context.elevated()
hosts = self.hosts_up(elevated, topic)

if not hosts:
msg = _("Is the appropriate service running?")
raise exception.NoValidHost(reason=msg)

remote_ip = context.remote_address

if remote_ip.startswith('10.1'):
hostname_prefix = 'doc'
elif remote_ip.startswith('10.2'):
hostname_prefix = 'ops'
else:
hostname_prefix = 'dev'

hosts = self._filter_hosts(hosts, hostname_prefix)
host = hosts[int(random.random() * len(hosts))]

LOG.debug(_("Request from %(remote_ip)s scheduled to %(host)s")
% locals())

return host

def schedule_run_instance(self, context, request_spec,
admin_password, injected_files,
requested_networks, is_first_time,
filter_properties):
"""Attempts to run the instance"""
instance_uuids = request_spec.get('instance_uuids')
for num, instance_uuid in enumerate(instance_uuids):
request_spec['instance_properties']['launch_index'] = num
try:
host = self._schedule(context, 'compute', request_spec,
filter_properties)
updated_instance = driver.instance_update_db(context,
instance_uuid)
self.compute_rpcapi.run_instance(context,
instance=updated_instance, host=host,
requested_networks=requested_networks,
injected_files=injected_files,
admin_password=admin_password,
is_first_time=is_first_time,
request_spec=request_spec,
filter_properties=filter_properties)
except Exception as ex:
# NOTE(vish): we don't reraise the exception here to make sure
# that all instances in the request get set to
# error properly
driver.handle_schedule_error(context, ex, instance_uuid,
request_spec)

def schedule_prep_resize(self, context, image, request_spec,
filter_properties, instance, instance_type,
reservations):
"""Select a target for resize."""
host = self._schedule(context, 'compute', request_spec,
filter_properties)
self.compute_rpcapi.prep_resize(context, image, instance,
instance_type, host, reservations)</pre><p> <code class="code">context</code> と <code class="code">request_spec</code> と <code class="code">filter_properties</code>には、どこにインスタンスをスケジュールするのか決定するのに使える有用な情報が多数含まれています。どんなプロパティが利用可能なのかを知るには、以下のログ出力文を上記の <code class="code">schedule_run_instance</code> メソッドに挿入してください。</p><pre class="programlisting">LOG.debug(_("context = %(context)s") % {'context': context.__dict__})LOG.debug(_("request_spec = %(request_spec)s") % locals())LOG.debug(_("filter_properties = %(filter_properties)s") % locals())</pre></li><li class="step"><p>このスケジューラーを Nova に組み込むには、設定ファイルを1つ編集する必要があります。</p><pre class="programlisting">LOG$ vim /etc/nova/nova.conf</pre></li><li class="step"><p><code class="code">compute_scheduler_driver</code> 設定を見つけ、このように変更してください。</p><pre class="programlisting">LOGcompute_scheduler_driver=nova.scheduler.ip_scheduler.IPScheduler</pre></li><li class="step"><p>Nova にこのスケジューラーを使わせるために、Nova スケジューラーサービスを再起動します。 <code class="code">n-sch</code> screen セッションに切り替えてはじめてください。</p><ol type="a" class="substeps"><li class="step"><p>Ctrl-A の後で 8 を押します。</p></li><li class="step"><p>Ctrl-C を押し、サービスを終了させます。</p></li><li class="step"><p>上矢印キーを押し、最後のコマンドを表示させます。</p></li><li class="step"><p>Enter キーを押し、実行します。</p></li></ol></li><li class="step"><p>Nova の CLI でスケジューラーのテストをしてください。shell の screen セッションに切り替えてテストを開始し、<code class="code">n-sch</code>  screen セッションにもどってログ出力をチェックして終了します。</p><ol type="a" class="substeps"><li class="step"><p>Ctrl-A の後で 0 を押します。</p></li><li class="step"><p>
                            <code class="code">cd ~/devstack</code>
                        </p></li><li class="step"><p>
                            <code class="code">source openrc</code>
                        </p></li><li class="step"><p>
                            <code class="code">IMAGE_ID=`nova image-list | egrep cirros | egrep -v "kernel|ramdisk" | awk '{print $2}'`</code>
                        </p></li><li class="step"><p>
                            <code class="code">nova boot --flavor 1 --image $IMAGE_ID scheduler-test</code>
                        </p></li><li class="step"><p>Ctrl-A の後で 8 を押します。</p></li></ol></li><li class="step"><p>ログの中に以下の行があるでしょう。</p><pre class="programlisting">LOG2013-02-27 17:39:31 DEBUG nova.scheduler.ip_scheduler [req-... demo demo] Request from 50.56.172.78 scheduled to
devstack-nova from (pid=4118) _schedule /opt/stack/nova/nova/scheduler/ip_scheduler.py:73</pre></li></ol></div><p>このような機能試験は、正しいユニットテストと結合テストの代わりになるものではありませんが、作業を開始することはできます。</p><p>ドライバ・アーキテクチャを使う他のすべてのプロジェクトで、類似のパターンに従うことができます。単純に、そのドライバ・インタフェースに従うモジュールとクラスを作成し、環境定義によって組み込んでください。あなたのコードはその機能が使われた時に実行され、必要に応じて他のサービスを呼び出します。プロジェクトのコア・コードは一切修正しません。ドライバ・アーキテクチャを使っているプロジェクトを確認するには、<code class="code">/etc/&lt;project&gt;</code> に格納されている、プロジェクトの環境定義ファイルの中で　<code class="code">driver</code> 変数を探してください。</p><p>あなたのスケジューラーが完成したら、オープンソースにし、OpenStack メーリングリストでコミュニティに知らせることをお薦めします。もしかしたら他の人も同じ機能を必要としているかもしれません。彼らはあなたのコードを使い、フィードバックし、おそらくコントリビュートするでしょう。もし十分な支持があれば、もしかしたら公式なNova <a class="link" href="https://github.com/openstack/nova/tree/master/nova/scheduler" target="_top">スケジューラー</a> (https://github.com/openstack/nova/tree/master/nova/scheduler) への追加を提案してもよいでしょう。</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ops_dashboard"> </a>Dashboard</h2></div></div></div><p>ダッシュボードは、Python <a class="link" href="https://www.djangoproject.com/" target="_top">Django</a> (https://www.djangoproject.com/) Webアプリケーションフレームワークに基づいています。カスタマイズのための最良のガイドは既に執筆されており、 <a class="link" href="http://docs.openstack.org/developer/horizon/topics/tutorial.html" target="_top">Build on Horizon</a> (http://docs.openstack.org/developer/horizon/topics/tutorial.html) にあります。</p></div></div><script type="text/javascript" src="../common/main.js"><!----></script><hr/><div id="disqus_thread"><script type="text/javascript">
	      if(window.location.protocol.substring(0,4) == 'http'){
	        var disqus_shortname = 'openstack-ops';
	      
	        var disqus_identifier = 'openstack-operations-guidecustomize';
	      
	      }
	    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script type="text/javascript" src="../common/comments.js"><!----></script></div><hr/><div class="legal"><a href="index.html">Legal notices</a></div></div><div><div id="leftnavigation" style="padding-top:3px; background-color:white;"><div id="tabs"><ul><li><a href="#treeDiv" tabindex="1"><span class="contentsTab">目次</span></a></li><li><a href="#searchDiv" tabindex="1"><span class="searchTab">Search</span></a></li></ul><div id="treeDiv"><img src="../common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"/><div id="ulTreeDiv" style="display:none" class="thisisthat"><ul id="tree" class="filetree"><li tabindex="2"><span class="file"><a href="ch_doc_history.html">ドキュメント変更履歴</a></span></li><li tabindex="2"><span class="file"><a href="section_yk2_jpr_lj.html">はじめに</a></span><ul><li tabindex="2"><span class="file"><a href="section_yk2_jpr_lj.html#chapter_gk2_jpr_lj">この本をなぜ書いたか？どうやって書いたか？</a></span></li><li tabindex="2"><span class="file"><a href="section_yk2_jpr_lj.html#section_gl2_jpr_lj">この本の作成に参加するには</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html">1. プロビジョニングとデプロイメント</a></span><ul><li tabindex="2"><span class="file"><a href="section_arch_provision.html#automated_deploy">自動デプロイメント</a></span><ul><li tabindex="2"><span class="file"><a href="section_arch_provision.html#disk_partition_raid">ディスクのパーティショニングと RAID</a></span></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html#network_config">ネットワーク設定</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html#auto_config">自動環境設定</a></span></li><li tabindex="2"><span class="file"><a href="section_arch_provision.html#remote_mgmt">リモート管理</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html">2. クラウドコントローラーの設計</a></span><ul><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#hardware_consid">ハードウェアの考慮事項</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#separate_services">サービスの分離</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#database">データベース</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#message_queue">メッセージキュー</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#api">Application Programming Interface (API)</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#extensions">API 拡張</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#scheduler">スケジューラー</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#images">イメージ</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#dashboard">Dashboard</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#authentication">認証および認可</a></span></li><li tabindex="2"><span class="file"><a href="cloud_controller_design.html#network_consid">ネットワークの考慮事項</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="scaling.html">3. スケーリング</a></span><ul><li tabindex="2"><span class="file"><a href="scaling.html#starting">スタートポイント</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#add_controller_nodes">Controller ノードの追加</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#segregate_cloud">クラウドの分離</a></span><ul><li tabindex="2"><span class="file"><a href="scaling.html#cells_regions">セルとリージョン</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#availability_zones">アベイラビリティゾーンとホストアグリゲート</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="scaling.html#scalable_hardware">スケーラブルハードウェア</a></span><ul><li tabindex="2"><span class="file"><a href="scaling.html#hardware_procure">ハードウェア調達</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#capacity_planning">キャパシティプランニング</a></span></li><li tabindex="2"><span class="file"><a href="scaling.html#burin_testing">エージング試験</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="compute_nodes.html">4. コンピュートノード</a></span><ul><li tabindex="2"><span class="file"><a href="compute_nodes.html#cpu_choice">CPU の選択</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#hypervisor_choice">ハイパーバイザーの選択</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#instance_storage">インスタンスストレージのソリューション</a></span><ul><li tabindex="2"><span class="file"><a href="compute_nodes.html#off_compute_node_storage">コンピュートノード外のストレージ – 共有ファイルシステム</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#on_compute_node_storage">コンピュートノード上のストレージ – 共有ファイルシステム</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#on_compute_node_storage_nonshared">コンピュートノード上のストレージ – 非共有ファイルシステム</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#live_migration">ライブマイグレーションに関する問題</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#file_systems">ファイルシステムの選択</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#overcommit">オーバーコミット</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#logging">ロギング</a></span></li><li tabindex="2"><span class="file"><a href="compute_nodes.html#networking">ネットワーク</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="storage_decision.html">5. ストレージ選定</a></span><ul><li tabindex="2"><span class="file"><a href="storage_decision.html#storage_concepts">ストレージのコンセプト</a></span><ul><li tabindex="2"><span class="file"><a href="storage_decision.html#object_storage">オブジェクト・ストレージ</a></span></li><li tabindex="2"><span class="file"><a href="storage_decision.html#block_storage">ブロックストレージ</a></span></li><li tabindex="2"><span class="file"><a href="storage_decision.html#file_level_storage">ファイルレベル・ストレージ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="storage_decision.html#storage_backends">ストレージ・バックエンドの選択</a></span><ul><li tabindex="2"><span class="file"><a href="storage_decision.html#commodity_storage_backends">コモディティ・ハードウェア上の ストレージ技術</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="storage_decision.html#openstack_object_storage">OpenStack Object Storage の注意事項</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="network_design.html">6. ネットワーク設計</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#mgmt_network">管理ネットワーク</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#public_addressing">パブリックアドレスの選択肢</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#ip_address_planning">IP アドレス計画</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#network_topology">ネットワークトポロジー</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#vlans">VLAN</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#multi_nic">マルチNIC</a></span></li><li tabindex="2"><span class="file"><a href="network_design.html#multi_host_single_host_networks">マルチホストネットワークとシングルホストネットワーク</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="network_design.html#services_for_networking">ネットワーク関係のサービス</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#ntp">NTP</a></span><ul><li tabindex="2"><span class="file"><a href="network_design.html#dns">DNS</a></span></li></ul></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="example_architecture.html">7. 参考アーキテクチャ</a></span><ul><li tabindex="2"><span class="file"><a href="example_architecture.html#overview">概要</a></span></li><li tabindex="2"><span class="file"><a href="example_architecture.html#rationale">設定指針</a></span><ul><li tabindex="2"><span class="file"><a href="example_architecture.html#quantum">なぜ OpenStack Network Service (quantum) を使わないか？</a></span></li><li tabindex="2"><span class="file"><a href="example_architecture.html#multi-host-networking">なぜマルチホストネットワークを使うか？</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="example_architecture.html#detailed_desc">詳細な説明</a></span></li><li tabindex="2"><span class="file"><a href="example_architecture.html#optional_extensions">さらなる拡張</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="whats_next.html">8. 次はどうする？</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html">9. 環境を把握する</a></span><ul><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#cli_tools">クライアントコマンドラインツール</a></span><ul><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#install_tools">ツールの導入</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#admin_cli">管理系コマンドラインツール</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#get_creds">認証情報の取得方法</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#cli_tricks">コマンドラインのこつと罠</a></span><ul><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#curl">cURL</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#servers_services">サーバーとサービス</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#network">ネットワーク</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#users_projects">ユーザおよびプロジェクト</a></span></li><li tabindex="2"><span class="file"><a href="lay_of_the_land.html#running_instances">稼働中インスタンス</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="projects_users.html">10. プロジェクトとユーザーの管理</a></span><ul><li tabindex="2"><span class="file"><a href="projects_users.html#projects_or_tenants">プロジェクトかテナントか?</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#managing_projects">プロジェクトの管理</a></span><ul><li tabindex="2"><span class="file"><a href="projects_users.html#add_projects">プロジェクトの追加</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="projects_users.html#quotas">クォータ</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#user_mgmt">ユーザー管理</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#create_new_users">新規ユーザーの作成</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#associate_users_with_projects">プロジェクトへのユーザーの割り当て</a></span><ul><li tabindex="2"><span class="file"><a href="projects_users.html#customize_auth">権限のカスタマイズ</a></span></li><li tabindex="2"><span class="file"><a href="projects_users.html#problem_users">他のユーザーに悪影響を与えるユーザー</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="user_facing_operations.html">11. ユーザーによる運用</a></span><ul><li tabindex="2"><span class="file"><a href="user_facing_images.html">イメージ</a></span><ul><li tabindex="2"><span class="file"><a href="user_facing_images.html#add_images">イメージの追加</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#delete_images">イメージの削除</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#other_cli">他の CLI オプション</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#image_service_and_database">イメージサービスおよびデータベース</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_images.html#sample_image_database">イメージサービスのデータベースクエリーの例</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="flavors.html">フレーバー</a></span><ul><li tabindex="2"><span class="file"><a href="flavors.html#d6e1977">どのように既存のフレーバーを変更しますか?</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="security_groups.html">セキュリティグループ</a></span></li><li tabindex="2"><span class="file"><a href="user_facing_block_storage.html">ブロックストレージ</a></span><ul><li tabindex="2"><span class="file"><a href="user_facing_block_storage.html#block_storage_creation_failures">ブロックストレージの作成エラー</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="instances.html">インスタンス</a></span><ul><li tabindex="2"><span class="file"><a href="instances.html#start_instances">インスタンスの起動</a></span></li><li tabindex="2"><span class="file"><a href="instances.html#instance_boot_failures">インスタンスの起動失敗</a></span></li><li tabindex="2"><span class="file"><a href="instances.html#instance_specific_data">インスタンス固有のデータ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="associate_security_groups.html">セキュリティグループの割り当て</a></span></li><li tabindex="2"><span class="file"><a href="floating_ips.html">Floating IP</a></span></li><li tabindex="2"><span class="file"><a href="attach_block_storage.html">ブロックストレージの接続</a></span></li><li tabindex="2"><span class="file"><a href="snapsnots.html">スナップショットの取得</a></span><ul><li tabindex="2"><span class="file"><a href="snapsnots.html#consistent_snapshots">スナップショットの一貫性の保証</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="database_instances.html">データベースにあるインスタンス</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html">12. メンテナンス、故障およびデバッグ</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#cloud_controller_storage">クラウドコントローラーとストレージプロキシの故障とメンテナンス</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#planned_maintenance">計画メンテナンス</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#reboot_cloud_controller">クラウドコントローラーとストレージプロキシの再起動</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#after_a_cc_reboot">クラウドコントローラーまたはストレージプロキシの再起動後</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#cc_failure">全体的なクラウドコントローラーの故障</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#compute_node_failures">コンピュートノードの故障とメンテナンス</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#planned_maintenance_compute_node">計画メンテナンス</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#after_compute_node_reboot">Compute ノードの再起動後</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#maintenance_instances">インスタンス</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#inspect_and_recover_failed_instances">故障したインスタンスからの検査とデータ復旧</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#volumes">ボリューム</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#totle_compute_node_failure">全体的なコンピュートノードの故障</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#var_lib_nova_instances">/var/lib/nova/instances</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#storage_node_failures">ストレージノードの故障とメンテナンス</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#reboot_storage_node">ストレージノードの再起動</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#shut_down_storage_node">ストレージノードのシャットダウン</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#replace_swift_disk">Swift ディスクの交換</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#complete_failure">完全な故障の対処</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#config_mgmt">構成管理</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#hardware">ハードウェアの取り扱い</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#add_new_node">コンピュートノードの追加</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#add_new_object_node">オブジェクトストレージノードの追加</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#replace_components">コンポーネントの交換</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#databases">データベース</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#database_connect">データベース接続性</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#perf_and_opt">パフォーマンスおよび最適化</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#hdmy">HDWMY</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#hourly">毎時</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#daily">日次</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#weekly">週次</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#monthly">月次</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#quarterly">四半期ごと</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#semiannual">半年ごと</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="maintenance.html#broken_component">故障しているコンポーネントの特定</a></span><ul><li tabindex="2"><span class="file"><a href="maintenance.html#tailing_logs">最新ログの確認</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#daemons_cli">CLI におけるデーモンの実行法</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#complexity">複雑さの例</a></span></li><li tabindex="2"><span class="file"><a href="maintenance.html#upgrades">アップグレード</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html">13. ネットワークのトラブルシューティング</a></span><ul><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#check_interface_states">"ip a" を使ってインタフェース状態をチェックする</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#network_traffic_in_cloud">クラウド上のネットワークトラフィック</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#failure_in_path">経路上の障害を見つける</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#tcpdump">tcpdump</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#iptables">iptables</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#network_config_database">データベースにあるネットワーク設定</a></span><ul><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#deassociate_floating_ip">手動でフローティングIPの関連付けを解除する</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#debug_dhcp_issues">DHCP の問題をデバッグする</a></span></li><li tabindex="2"><span class="file"><a href="network_troubleshooting.html#debugging_dns_issues">DNS の問題をデバッグする</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html">14. ロギングと監視</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#where_are_logs">ログはどこにあるのか？</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#cloud_controller_ops">クラウドコントローラー</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#compute_nodes_ops">コンピュートノード</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#block_storage_nodes">ブロックストレージ ノード</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#how_to_read_logs">ログの読み方</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#tracing_instance_request">インスタンスリクエストの追跡</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#add_custom_logging">カスタムログの追加</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#rabbitmq">RabbitMQ Web管理インターフェイス および rabbitmqctl</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#manage_logs_centrally">ログの集中管理</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#rsyslog_client_config">rsyslog クライアント設定</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#rsyslog_server_config">rsyslog サーバー設定</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#stacktach">StackTach</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#monitoring">監視</a></span><ul><li tabindex="2"><span class="file"><a href="logging_monitoring.html#process_monitoring">プロセス監視</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#resource_alerting">リソースのアラート</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#os_resources">OpenStack固有のリソース</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#intelligent_alerting">インテリジェントなアラート</a></span></li><li tabindex="2"><span class="file"><a href="logging_monitoring.html#trending">トレンド</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html">15. バックアップとリカバリー</a></span><ul><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#what_to_backup">バックアップ対象</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#database_backups">データベース バックアップ</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#file_system_backups">ファイルシステム バックアップ</a></span><ul><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#compute">Compute</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#image_catalog_delivery">イメージカタログと配布</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#identity">認証</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#ops_block_storage">ブロックストレージ</a></span></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#ops_object_storage">オブジェクト・ストレージ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="backup_and_recovery.html#recovering_backups">バックアップのリカバリー</a></span></li></ul></li><li tabindex="2" id="webhelp-currentid"><span class="file"><a href="customize.html">16. カスタマイズ</a></span><ul><li tabindex="2"><span class="file"><a href="customize.html#devstack">DevStack</a></span></li><li tabindex="2"><span class="file"><a href="customize.html#middleware_example">ミドルウェア例</a></span></li><li tabindex="2"><span class="file"><a href="customize.html#nova_scheduler_example">Nova スケジューラーの例</a></span></li><li tabindex="2"><span class="file"><a href="customize.html#ops_dashboard">Dashboard</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html">17. OpenStack コミュニティ</a></span><ul><li tabindex="2"><span class="file"><a href="upstream_openstack.html#get_help">助けを得る</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#report_bugs">バグ報告</a></span><ul><li tabindex="2"><span class="file"><a href="upstream_openstack.html#confirm_priority">バグの確認と優先付け</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#bug_fixing">バグ修正</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#after_change_is_accepted">変更が受理された後</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#openstack_community">OpenStack コミュニティに参加する</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#features">機能と開発ロードマップ</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#contribute_to_docs">ドキュメント作成への貢献の仕方</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#security_info">セキュリティ情報</a></span></li><li tabindex="2"><span class="file"><a href="upstream_openstack.html#additional_info">さらに情報を見つける</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="use-cases.html">A. 事例</a></span><ul><li tabindex="2"><span class="file"><a href="nectar.html">NeCTAR</a></span><ul><li tabindex="2"><span class="file"><a href="nectar_deploy.html">デプロイ</a></span></li><li tabindex="2"><span class="file"><a href="nectar_resources.html">リソース</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="mit_csail.html">MIT CSAIL</a></span><ul><li tabindex="2"><span class="file"><a href="mit_csail_deploy.html">デプロイ</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="dair.html">DAIR</a></span><ul><li tabindex="2"><span class="file"><a href="dair_deploy.html">デプロイ</a></span></li><li tabindex="2"><span class="file"><a href="dair_resources.html">リソース</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="cern.html">CERN</a></span><ul><li tabindex="2"><span class="file"><a href="cern_deploy.html">デプロイ</a></span></li><li tabindex="2"><span class="file"><a href="cern_resources.html">リソース</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="app_crypt.html">B. ハリウッド^H^H^H^H^Hクラウド・ナイトメア</a></span><ul><li tabindex="2"><span class="file"><a href="double_vlan.html">ダブル VLAN</a></span></li><li tabindex="2"><span class="file"><a href="issue.html">「あの問題」</a></span></li><li tabindex="2"><span class="file"><a href="disappear_images.html">イメージの消失</a></span></li><li tabindex="2"><span class="file"><a href="valentines.html">バレンタインデーの compute ノード大虐殺</a></span></li><li tabindex="2"><span class="file"><a href="rabbithole.html">ウサギの穴に落ちて</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="recommended-reading.html">C. リソース</a></span></li><li tabindex="2"><span class="file"><a href="go01.html">用語集</a></span></li></ul></div></div><div id="searchDiv"><div id="search"><form onsubmit="Verifie(ditaSearch_Form);return false" name="ditaSearch_Form" class="searchForm"><fieldset class="searchFieldSet"><legend>Search</legend><center><input id="textToSearch" name="textToSearch" type="text" class="searchText"/> &nbsp; <input onclick="Verifie(ditaSearch_Form)" type="button" class="searchButton" value="Go" id="doSearch"/></center></fieldset></form></div><div id="searchResults"><center/></div><p class="searchHighlight"><a href="#" onclick="toggleHighlight()">Search Highlighter (On/Off)</a></p></div></div></div></div><script type="text/javascript" src="../common/jquery/jquery.qtip-1.0.0-rc3/jquery.qtip-1.0.0-rc3.min.js"><!--jQuery plugin for glossary popups. -->
                   $('a[title]').qtip({ style: { name: 'cream', tip: true } })
                </script></body></html>